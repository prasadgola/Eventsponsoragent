<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Event Sponsor Assistant</title>
  <script src="https://js.stripe.com/v3/"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --sidebar-width: 308px;
      --sidebar-width-closed: 70px;

      /* Dark theme colors (default) */
      --bg-primary: #1d1d1d;
      --bg-secondary: #2d2d30;
      --bg-tertiary: #212121;
      --bg-hover: #3c4043;
      --bg-input: #212121;
      --bg-message-assistant: #2d2d30;
      --bg-message-user: #8ab4f8;

      --text-primary: #e8eaed;
      --text-secondary: #bdc1c6;
      --text-tertiary: #9aa0a6;
      --text-on-primary: #202124;

      --border-primary: #45474a;
      --border-secondary: #5f6368;

      --accent-primary: #8ab4f8;
      --accent-hover: #aecbfa;
      --accent-active: #1a73e8;

      --success: #34a853;
      --success-hover: #2d9246;
      --success-light: #81c995;

      --shadow: rgba(0, 0, 0, 0.3);
      --overlay: rgba(0, 0, 0, 0.5);
    }

    .light-theme {
      /* Light theme colors */
      --bg-primary: #ffffff;
      --bg-secondary: #f8f9fa;
      --bg-tertiary: #f8f9fa;
      --bg-hover: #e8eaed;
      --bg-input: #f8f9fa;
      --bg-message-assistant: #f1f3f4;
      --bg-message-user: #1a73e8;

      --text-primary: #202124;
      --text-secondary: #5f6368;
      --text-tertiary: #9aa0a6;
      --text-on-primary: #ffffff;

      --border-primary: #dadce0;
      --border-secondary: #dadce0;

      --accent-primary: #1a73e8;
      --accent-hover: #1765cc;
      --accent-active: #1a73e8;

      --success: #34a853;
      --success-hover: #2d9246;
      --success-light: #81c995;

      --shadow: rgba(0, 0, 0, 0.15);
      --overlay: rgba(0, 0, 0, 0.3);
    }

    /* --- Color Themes (24 variations) --- */

    /* ROW 1: Sky Blues - Fresh, Clean, Professional */
    .theme-c1 {
      --bg-primary: #f8fcff;
      --bg-secondary: #e3f2fd;
      --bg-tertiary: #e3f2fd;
      --bg-hover: #bbdefb;
      --bg-input: #ffffff;
      --bg-message-assistant: #e3f2fd;
      --bg-message-user: #5C9FF8;
      --text-primary: #1a237e;
      --text-secondary: #3949ab;
      --text-tertiary: #5c6bc0;
      --text-on-primary: #ffffff;
      --border-primary: #90caf9;
      --border-secondary: #64b5f6;
      --accent-primary: #5C9FF8;
      --accent-hover: #42A5F5;
      --accent-active: #2196f3;
      --success: #4caf50;
      --success-hover: #43a047;
      --success-light: #81c784;
      --shadow: rgba(92, 159, 248, 0.2);
      --overlay: rgba(33, 150, 243, 0.4);
    }

    .theme-c2 {
      --bg-primary: #f5faff;
      --bg-secondary: #e1f5fe;
      --bg-tertiary: #e1f5fe;
      --bg-hover: #b3e5fc;
      --bg-input: #ffffff;
      --bg-message-assistant: #e1f5fe;
      --bg-message-user: #42A5F5;
      --text-primary: #01579b;
      --text-secondary: #0277bd;
      --text-tertiary: #0288d1;
      --text-on-primary: #ffffff;
      --border-primary: #81d4fa;
      --border-secondary: #4fc3f7;
      --accent-primary: #42A5F5;
      --accent-hover: #29b6f6;
      --accent-active: #03a9f4;
      --success: #00bcd4;
      --success-hover: #00acc1;
      --success-light: #4dd0e1;
      --shadow: rgba(66, 165, 245, 0.2);
      --overlay: rgba(3, 169, 244, 0.4);
    }

    .theme-c3 {
      --bg-primary: #f0fbfc;
      --bg-secondary: #e0f7fa;
      --bg-tertiary: #e0f7fa;
      --bg-hover: #b2ebf2;
      --bg-input: #ffffff;
      --bg-message-assistant: #e0f7fa;
      --bg-message-user: #4DD0E1;
      --text-primary: #006064;
      --text-secondary: #00838f;
      --text-tertiary: #0097a7;
      --text-on-primary: #ffffff;
      --border-primary: #80deea;
      --border-secondary: #4dd0e1;
      --accent-primary: #4DD0E1;
      --accent-hover: #26c6da;
      --accent-active: #00bcd4;
      --success: #26a69a;
      --success-hover: #00897b;
      --success-light: #4db6ac;
      --shadow: rgba(77, 208, 225, 0.2);
      --overlay: rgba(0, 188, 212, 0.4);
    }

    /* ROW 2: Deep Purples - Elegant, Creative, Bold */
    .theme-c4 {
      --bg-primary: #faf8ff;
      --bg-secondary: #ede7f6;
      --bg-tertiary: #ede7f6;
      --bg-hover: #d1c4e9;
      --bg-input: #ffffff;
      --bg-message-assistant: #ede7f6;
      --bg-message-user: #3F51B5;
      --text-primary: #1a237e;
      --text-secondary: #283593;
      --text-tertiary: #303f9f;
      --text-on-primary: #ffffff;
      --border-primary: #9fa8da;
      --border-secondary: #7986cb;
      --accent-primary: #3F51B5;
      --accent-hover: #3949ab;
      --accent-active: #303f9f;
      --success: #7cb342;
      --success-hover: #689f38;
      --success-light: #9ccc65;
      --shadow: rgba(63, 81, 181, 0.25);
      --overlay: rgba(48, 63, 159, 0.45);
    }

    .theme-c5 {
      --bg-primary: #faf7ff;
      --bg-secondary: #f3e5f5;
      --bg-tertiary: #f3e5f5;
      --bg-hover: #e1bee7;
      --bg-input: #ffffff;
      --bg-message-assistant: #f3e5f5;
      --bg-message-user: #5E35B1;
      --text-primary: #4a148c;
      --text-secondary: #6a1b9a;
      --text-tertiary: #7b1fa2;
      --text-on-primary: #ffffff;
      --border-primary: #ce93d8;
      --border-secondary: #ba68c8;
      --accent-primary: #5E35B1;
      --accent-hover: #512da8;
      --accent-active: #4527a0;
      --success: #ab47bc;
      --success-hover: #9c27b0;
      --success-light: #ba68c8;
      --shadow: rgba(94, 53, 177, 0.25);
      --overlay: rgba(69, 39, 160, 0.45);
    }

    .theme-c6 {
      --bg-primary: #fdf5ff;
      --bg-secondary: #f3e5f5;
      --bg-tertiary: #f3e5f5;
      --bg-hover: #e1bee7;
      --bg-input: #ffffff;
      --bg-message-assistant: #f3e5f5;
      --bg-message-user: #9C27B0;
      --text-primary: #4a148c;
      --text-secondary: #6a1b9a;
      --text-tertiary: #7b1fa2;
      --text-on-primary: #ffffff;
      --border-primary: #ce93d8;
      --border-secondary: #ba68c8;
      --accent-primary: #9C27B0;
      --accent-hover: #8e24aa;
      --accent-active: #7b1fa2;
      --success: #ab47bc;
      --success-hover: #9c27b0;
      --success-light: #ce93d8;
      --shadow: rgba(156, 39, 176, 0.25);
      --overlay: rgba(123, 31, 162, 0.45);
    }

    /* ROW 3: Teals & Greens - Natural, Balanced, Calm */
    .theme-c7 {
      --bg-primary: #fcfaff;
      --bg-secondary: #f3e5f5;
      --bg-tertiary: #f3e5f5;
      --bg-hover: #e1bee7;
      --bg-input: #ffffff;
      --bg-message-assistant: #f3e5f5;
      --bg-message-user: #B39DDB;
      --text-primary: #4a148c;
      --text-secondary: #6a1b9a;
      --text-tertiary: #8e24aa;
      --text-on-primary: #4a148c;
      --border-primary: #ce93d8;
      --border-secondary: #ba68c8;
      --accent-primary: #B39DDB;
      --accent-hover: #9575cd;
      --accent-active: #7e57c2;
      --success: #66bb6a;
      --success-hover: #4caf50;
      --success-light: #81c784;
      --shadow: rgba(179, 157, 219, 0.2);
      --overlay: rgba(126, 87, 194, 0.4);
    }

    .theme-c8 {
      --bg-primary: #f0faf9;
      --bg-secondary: #e0f2f1;
      --bg-tertiary: #e0f2f1;
      --bg-hover: #b2dfdb;
      --bg-input: #ffffff;
      --bg-message-assistant: #e0f2f1;
      --bg-message-user: #4DB6AC;
      --text-primary: #004d40;
      --text-secondary: #00695c;
      --text-tertiary: #00796b;
      --text-on-primary: #ffffff;
      --border-primary: #80cbc4;
      --border-secondary: #4db6ac;
      --accent-primary: #4DB6AC;
      --accent-hover: #26a69a;
      --accent-active: #009688;
      --success: #66bb6a;
      --success-hover: #4caf50;
      --success-light: #81c784;
      --shadow: rgba(77, 182, 172, 0.2);
      --overlay: rgba(0, 150, 136, 0.4);
    }

    .theme-c9 {
      --bg-primary: #f1f8f4;
      --bg-secondary: #e8f5e9;
      --bg-tertiary: #e8f5e9;
      --bg-hover: #c8e6c9;
      --bg-input: #ffffff;
      --bg-message-assistant: #e8f5e9;
      --bg-message-user: #4CAF50;
      --text-primary: #1b5e20;
      --text-secondary: #2e7d32;
      --text-tertiary: #388e3c;
      --text-on-primary: #ffffff;
      --border-primary: #a5d6a7;
      --border-secondary: #81c784;
      --accent-primary: #4CAF50;
      --accent-hover: #43a047;
      --accent-active: #388e3c;
      --success: #66bb6a;
      --success-hover: #4caf50;
      --success-light: #81c784;
      --shadow: rgba(76, 175, 80, 0.2);
      --overlay: rgba(56, 142, 60, 0.4);
    }

    /* ROW 4: Lime & Yellow - Energetic, Vibrant, Optimistic */
    .theme-c10 {
      --bg-primary: #f9fef5;
      --bg-secondary: #f1f8e9;
      --bg-tertiary: #f1f8e9;
      --bg-hover: #dcedc8;
      --bg-input: #ffffff;
      --bg-message-assistant: #f1f8e9;
      --bg-message-user: #9CCC65;
      --text-primary: #33691e;
      --text-secondary: #558b2f;
      --text-tertiary: #689f38;
      --text-on-primary: #ffffff;
      --border-primary: #c5e1a5;
      --border-secondary: #aed581;
      --accent-primary: #9CCC65;
      --accent-hover: #8bc34a;
      --accent-active: #7cb342;
      --success: #66bb6a;
      --success-hover: #4caf50;
      --success-light: #81c784;
      --shadow: rgba(156, 204, 101, 0.2);
      --overlay: rgba(124, 179, 66, 0.4);
    }

    .theme-c11 {
      --bg-primary: #fefef5;
      --bg-secondary: #f9fbe7;
      --bg-tertiary: #f9fbe7;
      --bg-hover: #f0f4c3;
      --bg-input: #ffffff;
      --bg-message-assistant: #f9fbe7;
      --bg-message-user: #CDDC39;
      --text-primary: #827717;
      --text-secondary: #9e9d24;
      --text-tertiary: #afb42b;
      --text-on-primary: #3e2723;
      --border-primary: #e6ee9c;
      --border-secondary: #dce775;
      --accent-primary: #CDDC39;
      --accent-hover: #c0ca33;
      --accent-active: #afb42b;
      --success: #7cb342;
      --success-hover: #689f38;
      --success-light: #9ccc65;
      --shadow: rgba(205, 220, 57, 0.25);
      --overlay: rgba(175, 180, 43, 0.4);
    }

    .theme-c12 {
      --bg-primary: #fffef5;
      --bg-secondary: #fffde7;
      --bg-tertiary: #fffde7;
      --bg-hover: #fff9c4;
      --bg-input: #ffffff;
      --bg-message-assistant: #fffde7;
      --bg-message-user: #FFEB3B;
      --text-primary: #f57f17;
      --text-secondary: #f9a825;
      --text-tertiary: #fbc02d;
      --text-on-primary: #3e2723;
      --border-primary: #fff59d;
      --border-secondary: #fff176;
      --accent-primary: #FFEB3B;
      --accent-hover: #fdd835;
      --accent-active: #fbc02d;
      --success: #cddc39;
      --success-hover: #c0ca33;
      --success-light: #dce775;
      --shadow: rgba(255, 235, 59, 0.3);
      --overlay: rgba(251, 192, 45, 0.4);
    }

    /* ROW 5: Oranges - Warm, Inviting, Energetic */
    .theme-c13 {
      --bg-primary: #fffef8;
      --bg-secondary: #fff8e1;
      --bg-tertiary: #fff8e1;
      --bg-hover: #ffecb3;
      --bg-input: #ffffff;
      --bg-message-assistant: #fff8e1;
      --bg-message-user: #FBC02D;
      --text-primary: #e65100;
      --text-secondary: #ef6c00;
      --text-tertiary: #f57c00;
      --text-on-primary: #3e2723;
      --border-primary: #ffe082;
      --border-secondary: #ffd54f;
      --accent-primary: #FBC02D;
      --accent-hover: #f9a825;
      --accent-active: #f57f17;
      --success: #ffa726;
      --success-hover: #ff9800;
      --success-light: #ffb74d;
      --shadow: rgba(251, 192, 45, 0.25);
      --overlay: rgba(245, 127, 23, 0.4);
    }

    .theme-c14 {
      --bg-primary: #fffbf5;
      --bg-secondary: #fff3e0;
      --bg-tertiary: #fff3e0;
      --bg-hover: #ffe0b2;
      --bg-input: #ffffff;
      --bg-message-assistant: #fff3e0;
      --bg-message-user: #FFCC80;
      --text-primary: #e65100;
      --text-secondary: #ef6c00;
      --text-tertiary: #f57c00;
      --text-on-primary: #3e2723;
      --border-primary: #ffcc80;
      --border-secondary: #ffb74d;
      --accent-primary: #FFCC80;
      --accent-hover: #ffb74d;
      --accent-active: #ffa726;
      --success: #ff9800;
      --success-hover: #fb8c00;
      --success-light: #ffa726;
      --shadow: rgba(255, 204, 128, 0.25);
      --overlay: rgba(255, 167, 38, 0.4);
    }

    .theme-c15 {
      --bg-primary: #fff9f5;
      --bg-secondary: #fbe9e7;
      --bg-tertiary: #fbe9e7;
      --bg-hover: #ffccbc;
      --bg-input: #ffffff;
      --bg-message-assistant: #fbe9e7;
      --bg-message-user: #FB8C00;
      --text-primary: #bf360c;
      --text-secondary: #d84315;
      --text-tertiary: #e64a19;
      --text-on-primary: #ffffff;
      --border-primary: #ffab91;
      --border-secondary: #ff8a65;
      --accent-primary: #FB8C00;
      --accent-hover: #f57c00;
      --accent-active: #ef6c00;
      --success: #ff9800;
      --success-hover: #fb8c00;
      --success-light: #ffa726;
      --shadow: rgba(251, 140, 0, 0.25);
      --overlay: rgba(239, 108, 0, 0.4);
    }

    /* ROW 6: Reds & Pinks - Passionate, Bold, Attention-Grabbing */
    .theme-c16 {
      --bg-primary: #fff8f5;
      --bg-secondary: #fbe9e7;
      --bg-tertiary: #fbe9e7;
      --bg-hover: #ffccbc;
      --bg-input: #ffffff;
      --bg-message-assistant: #fbe9e7;
      --bg-message-user: #FF5722;
      --text-primary: #bf360c;
      --text-secondary: #d84315;
      --text-tertiary: #e64a19;
      --text-on-primary: #ffffff;
      --border-primary: #ffab91;
      --border-secondary: #ff8a65;
      --accent-primary: #FF5722;
      --accent-hover: #f4511e;
      --accent-active: #e64a19;
      --success: #66bb6a;
      --success-hover: #4caf50;
      --success-light: #81c784;
      --shadow: rgba(255, 87, 34, 0.25);
      --overlay: rgba(230, 74, 25, 0.45);
    }

    .theme-c17 {
      --bg-primary: #fff5f5;
      --bg-secondary: #ffebee;
      --bg-tertiary: #ffebee;
      --bg-hover: #ffcdd2;
      --bg-input: #ffffff;
      --bg-message-assistant: #ffebee;
      --bg-message-user: #C62828;
      --text-primary: #b71c1c;
      --text-secondary: #c62828;
      --text-tertiary: #d32f2f;
      --text-on-primary: #ffffff;
      --border-primary: #ef9a9a;
      --border-secondary: #e57373;
      --accent-primary: #C62828;
      --accent-hover: #b71c1c;
      --accent-active: #d32f2f;
      --success: #66bb6a;
      --success-hover: #4caf50;
      --success-light: #81c784;
      --shadow: rgba(198, 40, 40, 0.25);
      --overlay: rgba(183, 28, 28, 0.45);
    }

    .theme-c18 {
      --bg-primary: #fff5f8;
      --bg-secondary: #fce4ec;
      --bg-tertiary: #fce4ec;
      --bg-hover: #f8bbd0;
      --bg-input: #ffffff;
      --bg-message-assistant: #fce4ec;
      --bg-message-user: #E91E63;
      --text-primary: #880e4f;
      --text-secondary: #ad1457;
      --text-tertiary: #c2185b;
      --text-on-primary: #ffffff;
      --border-primary: #f48fb1;
      --border-secondary: #f06292;
      --accent-primary: #E91E63;
      --accent-hover: #d81b60;
      --accent-active: #c2185b;
      --success: #ec407a;
      --success-hover: #e91e63;
      --success-light: #f06292;
      --shadow: rgba(233, 30, 99, 0.25);
      --overlay: rgba(194, 24, 91, 0.45);
    }

    /* ROW 7: Soft Pinks & Neutrals - Gentle, Sophisticated, Elegant */
    .theme-c19 {
      --bg-primary: #fff5f8;
      --bg-secondary: #fce4ec;
      --bg-tertiary: #fce4ec;
      --bg-hover: #f8bbd0;
      --bg-input: #ffffff;
      --bg-message-assistant: #fce4ec;
      --bg-message-user: #F06292;
      --text-primary: #880e4f;
      --text-secondary: #ad1457;
      --text-tertiary: #c2185b;
      --text-on-primary: #ffffff;
      --border-primary: #f48fb1;
      --border-secondary: #f06292;
      --accent-primary: #F06292;
      --accent-hover: #ec407a;
      --accent-active: #e91e63;
      --success: #ab47bc;
      --success-hover: #9c27b0;
      --success-light: #ba68c8;
      --shadow: rgba(240, 98, 146, 0.2);
      --overlay: rgba(233, 30, 99, 0.4);
    }

    .theme-c20 {
      --bg-primary: #fffafc;
      --bg-secondary: #fce4ec;
      --bg-tertiary: #fce4ec;
      --bg-hover: #f8bbd0;
      --bg-input: #ffffff;
      --bg-message-assistant: #fce4ec;
      --bg-message-user: #F8BBD0;
      --text-primary: #880e4f;
      --text-secondary: #ad1457;
      --text-tertiary: #c2185b;
      --text-on-primary: #4a148c;
      --border-primary: #f8bbd0;
      --border-secondary: #f48fb1;
      --accent-primary: #F8BBD0;
      --accent-hover: #f48fb1;
      --accent-active: #f06292;
      --success: #ba68c8;
      --success-hover: #ab47bc;
      --success-light: #ce93d8;
      --shadow: rgba(248, 187, 208, 0.2);
      --overlay: rgba(240, 98, 146, 0.35);
    }

    .theme-c21 {
      --bg-primary: #fffef9;
      --bg-secondary: #f5f1e8;
      --bg-tertiary: #f5f1e8;
      --bg-hover: #ebe6d1;
      --bg-input: #ffffff;
      --bg-message-assistant: #f5f1e8;
      --bg-message-user: #EBE6D1;
      --text-primary: #3e2723;
      --text-secondary: #4e342e;
      --text-tertiary: #5d4037;
      --text-on-primary: #3e2723;
      --border-primary: #d7ccc8;
      --border-secondary: #bcaaa4;
      --accent-primary: #EBE6D1;
      --accent-hover: #d7ccc8;
      --accent-active: #bcaaa4;
      --success: #a1887f;
      --success-hover: #8d6e63;
      --success-light: #bcaaa4;
      --shadow: rgba(235, 230, 209, 0.3);
      --overlay: rgba(188, 170, 164, 0.4);
    }

    /* ROW 8: Earth Tones - Grounded, Professional, Stable */
    .theme-c22 {
      --bg-primary: #fafafa;
      --bg-secondary: #efebe9;
      --bg-tertiary: #efebe9;
      --bg-hover: #d7ccc8;
      --bg-input: #ffffff;
      --bg-message-assistant: #efebe9;
      --bg-message-user: #5D4037;
      --text-primary: #3e2723;
      --text-secondary: #4e342e;
      --text-tertiary: #5d4037;
      --text-on-primary: #ffffff;
      --border-primary: #bcaaa4;
      --border-secondary: #a1887f;
      --accent-primary: #5D4037;
      --accent-hover: #4e342e;
      --accent-active: #3e2723;
      --success: #7cb342;
      --success-hover: #689f38;
      --success-light: #9ccc65;
      --shadow: rgba(93, 64, 55, 0.25);
      --overlay: rgba(62, 39, 35, 0.45);
    }

    .theme-c23 {
      --bg-primary: #fafafa;
      --bg-secondary: #f5f5f5;
      --bg-tertiary: #f5f5f5;
      --bg-hover: #eeeeee;
      --bg-input: #ffffff;
      --bg-message-assistant: #f5f5f5;
      --bg-message-user: #BDBDBD;
      --text-primary: #212121;
      --text-secondary: #424242;
      --text-tertiary: #616161;
      --text-on-primary: #212121;
      --border-primary: #e0e0e0;
      --border-secondary: #bdbdbd;
      --accent-primary: #BDBDBD;
      --accent-hover: #9e9e9e;
      --accent-active: #757575;
      --success: #66bb6a;
      --success-hover: #4caf50;
      --success-light: #81c784;
      --shadow: rgba(189, 189, 189, 0.2);
      --overlay: rgba(117, 117, 117, 0.4);
    }

    .theme-c24 {
      --bg-primary: #fafbfc;
      --bg-secondary: #eceff1;
      --bg-tertiary: #eceff1;
      --bg-hover: #cfd8dc;
      --bg-input: #ffffff;
      --bg-message-assistant: #eceff1;
      --bg-message-user: #78909C;
      --text-primary: #263238;
      --text-secondary: #37474f;
      --text-tertiary: #455a64;
      --text-on-primary: #ffffff;
      --border-primary: #b0bec5;
      --border-secondary: #90a4ae;
      --accent-primary: #78909C;
      --accent-hover: #607d8b;
      --accent-active: #546e7a;
      --success: #66bb6a;
      --success-hover: #4caf50;
      --success-light: #81c784;
      --shadow: rgba(120, 144, 156, 0.2);
      --overlay: rgba(84, 110, 122, 0.4);
    }

    /* --- End of Color Themes --- */

    .sidebar {
      background: var(--bg-secondary);
      border-right: 1px solid var(--border-primary);
      position: fixed;
      top: 0;
      left: 0;
      bottom: 0;
      width: var(--sidebar-width);
      z-index: 200;
      transform: translateX(-100%);
      transition: transform 0.2s ease-out, width 0.2s ease-out;
      display: flex;
      flex-direction: column;
    }

    .sidebar-header {
      height: var(--header-height);
      display: flex;
      align-items: center;
      padding: 0 15px;
      flex-shrink: 0;
    }

    .sidebar-content {
      padding: 1.5rem;
      overflow-y: auto;
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .sidebar-title {
      font-size: 1.2rem;
      font-weight: 500;
      color: var(--text-primary);
      padding: 0.5rem 0.75rem;
      margin-bottom: 1rem;
    }

    .sidebar-nav {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
      flex: 1;
    }

    .sidebar-link {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 0.75rem 1rem;
      border-radius: 8px;
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 0.95rem;
      transition: all 0.2s ease;
      cursor: pointer;
      border: none;
      background: transparent;
      width: 100%;
      text-align: left;
      position: relative;
      z-index: 1;
    }

    .sidebar-link svg {
      width: 18px;
      height: 18px;
      flex-shrink: 0;
      color: var(--text-tertiary);
      transition: color 0.2s ease;
    }

    .sidebar-link:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
    }

    .sidebar-link:hover svg {
      color: var(--text-primary);
    }

    .sidebar-footer {
      margin-top: auto;
      padding-top: 1rem;
      border-top: 1px solid var(--border-primary);
    }

    .sidebar-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 199;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease-out;
    }

    /* Settings Modal */
    .settings-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--overlay);
      z-index: 300;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 2rem;
    }

    .settings-modal.active {
      display: flex;
    }

    .settings-content {
      background: var(--bg-secondary);
      border-radius: 12px;
      width: 100%;
      max-width: 500px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 40px var(--shadow);
    }

    .settings-header {
      padding: 1.5rem;
      border-bottom: 1px solid var(--border-primary);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .settings-header h2 {
      color: var(--text-primary);
      font-size: 1.25rem;
      font-weight: 500;
    }

    .settings-close {
      background: transparent;
      border: none;
      color: var(--text-tertiary);
      cursor: pointer;
      padding: 0.5rem;
      border-radius: 8px;
      transition: all 0.2s ease;
    }

    .settings-close:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
    }

    .settings-body {
      padding: 1.5rem;
    }

    .settings-section {
      margin-bottom: 2rem;
    }

    .settings-section:last-child {
      margin-bottom: 0;
    }

    .settings-section-title {
      color: var(--text-primary);
      font-size: 1rem;
      font-weight: 500;
      margin-bottom: 0.75rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .settings-section-title svg {
      width: 20px;
      height: 20px;
      color: var(--accent-primary);
    }

    .settings-section-desc {
      color: var(--text-tertiary);
      font-size: 0.875rem;
      margin-bottom: 1rem;
    }

    .form-group {
      margin-bottom: 1rem;
    }

    .form-label {
      display: block;
      color: var(--text-secondary);
      font-size: 0.875rem;
      margin-bottom: 0.5rem;
    }

    .form-input {
      width: 100%;
      background: var(--bg-input);
      border: 1px solid var(--border-primary);
      border-radius: 8px;
      padding: 0.75rem;
      color: var(--text-primary);
      font-size: 0.875rem;
      transition: all 0.2s ease;
    }

    .form-input:focus {
      outline: none;
      border-color: var(--accent-primary);
      box-shadow: 0 0 0 3px rgba(138, 180, 248, 0.1);
    }

    .form-input::placeholder {
      color: var(--text-tertiary);
    }

    .oauth-button {
      width: 100%;
      background: var(--accent-primary);
      color: var(--text-on-primary);
      border: none;
      border-radius: 8px;
      padding: 0.75rem 1rem;
      font-size: 0.875rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .oauth-button:hover {
      background: var(--accent-hover);
      transform: translateY(-1px);
    }

    .oauth-button.connected {
      background: var(--success);
      color: #ffffff;
    }

    .oauth-button.connected:hover {
      background: var(--success-hover);
    }

    .oauth-button svg {
      width: 18px;
      height: 18px;
    }

    .settings-actions {
      padding: 1.5rem;
      border-top: 1px solid var(--border-primary);
      display: flex;
      gap: 1rem;
      justify-content: flex-end;
    }

    .btn-secondary {
      background: transparent;
      color: var(--text-secondary);
      border: 1px solid var(--border-primary);
      border-radius: 8px;
      padding: 0.75rem 1.5rem;
      font-size: 0.875rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .btn-secondary:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
    }

    .btn-primary {
      background: var(--accent-primary);
      color: var(--text-on-primary);
      border: none;
      border-radius: 8px;
      padding: 0.75rem 1.5rem;
      font-size: 0.875rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .btn-primary:hover {
      background: var(--accent-hover);
      transform: translateY(-1px);
    }

    .connection-status {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1rem;
      background: var(--bg-input);
      border-radius: 8px;
      margin-bottom: 1rem;
    }

    .status-indicator {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--border-secondary);
    }

    .status-indicator.connected {
      background: var(--success);
    }

    .status-text {
      color: var(--text-tertiary);
      font-size: 0.875rem;
    }

    .status-text.connected {
      color: var(--success-light);
    }

    /* Dropup Menu */
    .dropup-container {
      position: relative;
    }

    .dropup-menu {
      position: absolute;
      bottom: 100%;
      left: 0;
      background: var(--bg-secondary);
      border: 1px solid var(--border-primary);
      border-radius: 8px;
      box-shadow: 0 -4px 12px var(--shadow);
      margin-bottom: 8px;
      min-width: 240px;
      display: none;
      z-index: 250;
      padding: 0.5rem;
    }

    .dropup-menu.active {
      display: block;
    }

    .dropup-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem 1rem;
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 0.95rem;
      transition: all 0.2s ease;
      cursor: pointer;
      border: none;
      background: transparent;
      width: 100%;
      text-align: left;
      border-radius: 6px;
    }

    .dropup-item svg {
      width: 18px;
      height: 18px;
      flex-shrink: 0;
      color: var(--text-tertiary);
      transition: color 0.2s ease;
    }

    .dropup-item:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
    }

    .dropup-item:hover svg {
      color: var(--text-primary);
    }

    .dropup-divider {
      height: 1px;
      background: var(--border-primary);
      margin: 0.5rem 0.5rem;
    }

    .theme-selector {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      padding: 0.5rem;
      justify-content: center;
    }

    .theme-button {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      border: 2px solid var(--border-primary);
      cursor: pointer;
      transition: all 0.2s ease;
      padding: 0;
      flex-shrink: 0;
    }

    .theme-button:hover {
      transform: scale(1.1);
      border-color: var(--accent-primary);
    }

    /* Theme button specific colors */
    #theme-btn-c1 {
      background-color: #5C9FF8;
    }

    #theme-btn-c2 {
      background-color: #42A5F5;
    }

    #theme-btn-c3 {
      background-color: #4DD0E1;
    }

    #theme-btn-c4 {
      background-color: #3F51B5;
    }

    #theme-btn-c5 {
      background-color: #5E35B1;
    }

    #theme-btn-c6 {
      background-color: #9C27B0;
    }

    #theme-btn-c7 {
      background-color: #B39DDB;
    }

    #theme-btn-c8 {
      background-color: #4DB6AC;
    }

    #theme-btn-c9 {
      background-color: #4CAF50;
    }

    #theme-btn-c10 {
      background-color: #9CCC65;
    }

    #theme-btn-c11 {
      background-color: #CDDC39;
    }

    #theme-btn-c12 {
      background-color: #FFEB3B;
    }

    #theme-btn-c13 {
      background-color: #FBC02D;
    }

    #theme-btn-c14 {
      background-color: #FFCC80;
    }

    #theme-btn-c15 {
      background-color: #FB8C00;
    }

    #theme-btn-c16 {
      background-color: #FF5722;
    }

    #theme-btn-c17 {
      background-color: #C62828;
    }

    #theme-btn-c18 {
      background-color: #E91E63;
    }

    #theme-btn-c19 {
      background-color: #F06292;
    }

    #theme-btn-c20 {
      background-color: #F8BBD0;
    }

    #theme-btn-c21 {
      background-color: #EBE6D1;
    }

    #theme-btn-c22 {
      background-color: #5D4037;
    }

    #theme-btn-c23 {
      background-color: #BDBDBD;
    }

    #theme-btn-c24 {
      background-color: #78909C;
    }


    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      height: 100vh;
      display: flex;
      flex-direction: column;
      transition: all 0.3s ease;
      --header-height: 64px;
    }

    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem 2rem;
      background: var(--bg-primary);
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 100;
      height: var(--header-height);
      transition: left 0.2s ease-out, width 0.2s ease-out;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .header-info h1 {
      color: var(--text-primary);
      font-size: 1.25rem;
      font-weight: 500;
      margin: 0;
      display: flex;
      gap: 2px;
      cursor: pointer;
    }

    .jelly-logo span {
      display: inline-block;
      animation: jelly 20s cubic-bezier(0.36, 0.07, 0.19, 0.97) infinite;
    }

    .jelly-logo span:nth-child(1) {
      animation-delay: 0s;
    }

    .jelly-logo span:nth-child(2) {
      animation-delay: 0.1s;
    }

    .jelly-logo span:nth-child(3) {
      animation-delay: 0.2s;
    }

    .jelly-logo span:nth-child(4) {
      animation-delay: 0.3s;
    }

    .jelly-logo span:nth-child(5) {
      animation-delay: 0.4s;
    }

    .jelly-logo span:nth-child(6) {
      animation-delay: 0.5s;
    }

    @keyframes jelly {

      0%,
      100% {
        transform: scale(1, 1) rotate(0deg);
      }

      2% {
        transform: scale(1.1, 0.9) rotate(-2deg);
      }

      4% {
        transform: scale(0.9, 1.1) rotate(2deg);
      }

      5% {
        transform: scale(1.05, 0.95) rotate(-1deg);
      }

      8% {
        transform: scale(0.95, 1.05) rotate(1deg);
      }
    }

    .menu-btn {
      background: transparent;
      color: var(--text-tertiary);
      border: none;
      padding: 0.5rem;
      border-radius: 50%;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
    }

    .menu-btn:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
    }

    .desktop-menu-btn {
      display: none;
    }

    .mobile-menu-btn {
      display: flex;
    }

    .main-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      max-width: 680px;
      margin: 0 auto;
      width: 100%;
      position: relative;
      justify-content: flex-start;
      padding-top: var(--header-height);
      transition: justify-content 0.5s ease;
    }

    .welcome-screen {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 10rem;
      text-align: center;
      transition: all 0.5s ease;
      padding-bottom: 1.5rem;
    }

    .welcome-screen.hidden {
      opacity: 0;
      transform: translateY(-20px);
      pointer-events: none;
    }

    .welcome-title {
      font-size: 2.5rem;
      font-weight: 400;
      margin-bottom: 0.5rem;
      background: linear-gradient(45deg, #8ab4f8, #a8c7fa, #c58af9);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .messages {
      flex: 1;
      overflow-y: auto;
      padding: 2rem 1rem;
      display: none;
    }

    .messages.active {
      display: block;
    }

    .message {
      display: flex;
      gap: 1rem;
      margin-bottom: 2rem;
      max-width: 100%;
      animation: fadeInUp 0.3s ease-out;
    }

    .message.user {
      justify-content: flex-end;
    }

    .message.user .message-content {
      background: var(--bg-message-user);
      color: var(--text-on-primary);
      border: 1px solid var(--border-primary);
    }

    /* Ensure user text is readable on new themes */
    .theme-c1 .message.user .message-content,
    .theme-c2 .message.user .message-content,
    .theme-c3 .message.user .message-content,
    .theme-c7 .message.user .message-content,
    .theme-c8 .message.user .message-content,
    .theme-c9 .message.user .message-content,
    .theme-c10 .message.user .message-content,
    .theme-c11 .message.user .message-content,
    .theme-c12 .message.user .message-content,
    .theme-c13 .message.user .message-content,
    .theme-c14 .message.user .message-content,
    .theme-c15 .message.user .message-content,
    .theme-c16 .message.user .message-content,
    .theme-c19 .message.user .message-content,
    .theme-c20 .message.user .message-content,
    .theme-c21 .message.user .message-content,
    .theme-c23 .message.user .message-content,
    .theme-c24 .message.user .message-content {
      color: #212121;
    }

    .theme-c4 .message.user .message-content,
    .theme-c5 .message.user .message-content,
    .theme-c6 .message.user .message-content,
    .theme-c17 .message.user .message-content,
    .theme-c18 .message.user .message-content,
    .theme-c22 .message.user .message-content {
      color: #ffffff;
    }


    .message.assistant .message-content {
      background: transparent;
      color: var(--text-primary);
      border: none;
    }

    .avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 12px;
      display: none;
    }

    .message.user .avatar {
      background: var(--accent-primary);
      color: var(--text-on-primary);
      order: 1;
    }

    /* Avatar text color fixes */
    .theme-c1 .message.user .avatar,
    .theme-c2 .message.user .avatar,
    .theme-c3 .message.user .avatar,
    .theme-c7 .message.user .avatar,
    .theme-c8 .message.user .avatar,
    .theme-c9 .message.user .avatar,
    .theme-c10 .message.user .avatar,
    .theme-c11 .message.user .avatar,
    .theme-c12 .message.user .avatar,
    .theme-c13 .message.user .avatar,
    .theme-c14 .message.user .avatar,
    .theme-c15 .message.user .avatar,
    .theme-c16 .message.user .avatar,
    .theme-c19 .message.user .avatar,
    .theme-c20 .message.user .avatar,
    .theme-c21 .message.user .avatar,
    .theme-c23 .message.user .avatar,
    .theme-c24 .message.user .avatar {
      color: #212121;
    }

    .theme-c4 .message.user .avatar,
    .theme-c5 .message.user .avatar,
    .theme-c6 .message.user .avatar,
    .theme-c17 .message.user .avatar,
    .theme-c18 .message.user .avatar,
    .theme-c22 .message.user .avatar {
      color: #ffffff;
    }


    .message.assistant .avatar {
      background: var(--accent-primary);
      color: var(--text-on-primary);
    }

    /* Avatar text color fixes */
    .theme-c1 .message.assistant .avatar,
    .theme-c2 .message.assistant .avatar,
    .theme-c3 .message.assistant .avatar,
    .theme-c7 .message.assistant .avatar,
    .theme-c8 .message.assistant .avatar,
    .theme-c9 .message.assistant .avatar,
    .theme-c10 .message.assistant .avatar,
    .theme-c11 .message.assistant .avatar,
    .theme-c12 .message.assistant .avatar,
    .theme-c13 .message.assistant .avatar,
    .theme-c14 .message.assistant .avatar,
    .theme-c15 .message.assistant .avatar,
    .theme-c16 .message.assistant .avatar,
    .theme-c19 .message.assistant .avatar,
    .theme-c20 .message.assistant .avatar,
    .theme-c21 .message.assistant .avatar,
    .theme-c23 .message.assistant .avatar,
    .theme-c24 .message.assistant .avatar {
      color: #212121;
    }

    .theme-c4 .message.assistant .avatar,
    .theme-c5 .message.assistant .avatar,
    .theme-c6 .message.assistant .avatar,
    .theme-c17 .message.assistant .avatar,
    .theme-c18 .message.assistant .avatar,
    .theme-c22 .message.assistant .avatar {
      color: #ffffff;
    }


    .message-content {
      max-width: 95%;
      padding: 1rem 1.25rem;
      border-radius: 18px;
      line-height: 1.5;
      word-wrap: break-word;
    }

    .message-content.with-attachments {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .message-attachments {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }

    .message-attachment {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid var(--border-primary);
      border-radius: 8px;
      padding: 0.5rem 0.75rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.85rem;
    }

    .message-attachment img {
      max-width: 150px;
      max-height: 150px;
      border-radius: 4px;
    }

    .message-content .file-bubble-preview {
      padding: 10px 12px;
      background: var(--bg-hover);
      border-radius: 8px;
      margin-bottom: 8px;
      font-size: 0.9em;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .message-content img,
    .message-content video {
      max-width: 100%;
      height: auto;
      border-radius: 8px;
      margin-top: 0.5rem;
      display: block;
    }

    .message-content video {
      background: #000;
    }


    .message.user .message-content {
      border-bottom-right-radius: 6px;
    }

    .message.assistant .message-content {
      border-bottom-left-radius: 6px;
    }

    .loading-message {
      display: flex;
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .loading-content {
      background: transparent;
      color: var(--text-primary);
      padding: 1rem 1.25rem;
      border-radius: 18px;
      border-bottom-left-radius: 6px;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .typing-indicator {
      display: flex;
      gap: 4px;
    }

    .dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--text-tertiary);
      animation: bounce 1.4s infinite ease-in-out both;
    }

    .dot:nth-child(1) {
      animation-delay: -0.32s;
    }

    .dot:nth-child(2) {
      animation-delay: -0.16s;
    }

    @keyframes bounce {

      0%,
      80%,
      100% {
        transform: scale(0);
      }

      40% {
        transform: scale(1);
      }
    }

    .input-area {
      padding: 1rem 1rem 2rem;
      background: transparent;
      transition: background 0.3s ease;
      width: 100%;
    }

    .input-wrapper {
      max-width: 680px;
      margin: 0 auto;
      width: 100%;
    }

    .file-preview-container {
      display: none;
      margin-bottom: 0.75rem;
      gap: 0.5rem;
      flex-wrap: wrap;
      width: 100%;
      max-width: 100%;
    }

    .file-preview-item {
      display: flex;
      align-items: center;
      gap: 8px;
      background: var(--bg-hover);
      border: 1px solid var(--border-primary);
      border-radius: 12px;
      padding: 8px 12px;
      font-size: 0.9rem;
      max-width: 200px;
    }


    .file-preview-item img {
      width: 40px;
      height: 40px;
      object-fit: cover;
      border-radius: 6px;
    }

    .file-preview-item .file-info {
      display: flex;
      flex-direction: column;
      gap: 0.15rem;
      flex: 1;
      min-width: 0;
      overflow: hidden;
    }

    .file-preview-item .file-name {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .file-preview-item .file-size {
      font-size: 0.8rem;
      color: var(--text-tertiary);
    }


    .file-preview-remove {
      background: var(--bg-hover);
      color: var(--text-primary);
      border: none;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 14px;
      line-height: 20px;
      margin-left: 8px;
    }


    body.sidebar-open .sidebar {
      transform: translateX(0);
    }

    body.sidebar-open .sidebar-overlay {
      opacity: 1;
      pointer-events: auto;
    }

    @media (min-width: 1024px) {
      .desktop-menu-btn {
        display: flex;
      }

      .mobile-menu-btn {
        display: none;
      }

      body {
        padding-left: var(--sidebar-width);
        transition: padding-left 0.2s ease-out;
      }

      .sidebar {
        transform: translateX(0);
        z-index: 99;
        padding-top: 0;
        width: var(--sidebar-width);
      }

      .sidebar .sidebar-content {
        opacity: 1;
        pointer-events: auto;
        transition: opacity 0.2s ease-in 0.1s;
      }

      .header {
        left: var(--sidebar-width);
        width: calc(100% - var(--sidebar-width));
      }

      .sidebar-overlay {
        display: none;
      }

      .mobile-menu-btn .icon-arrow {
        display: none;
      }

      .mobile-menu-btn .icon-menu {
        display: block;
      }

      body.sidebar-open .mobile-menu-btn .icon-arrow {
        display: block;
      }

      body.sidebar-open .mobile-menu-btn .icon-menu {
        display: none;
      }

      body.sidebar-closed {
        padding-left: var(--sidebar-width-closed);
      }

      body.sidebar-closed .sidebar {
        width: var(--sidebar-width-closed);
      }

      body.sidebar-closed .sidebar .sidebar-content {
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.1s ease-out;
      }

      body.sidebar-closed .header {
        left: var(--sidebar-width-closed);
        width: calc(100% - var(--sidebar-width-closed));
      }
    }

    .input-container {
      display: flex;
      flex-direction: column;
      background: var(--bg-input);
      border: 1px solid var(--border-primary);
      border-radius: 24px;
      padding: 0.5rem;
      transition: all 0.2s ease;
      max-width: 100%;
      min-height: 56px;
    }

    .textarea-wrapper {
      flex: 1;
      display: flex;
      min-height: 24px;
      max-height: 200px;
      overflow: hidden;
    }

    .input-container:focus-within {
      border-color: var(--border-primary);
      box-shadow: none;
    }

    .message-input {
      flex: 1;
      min-height: 24px;
      max-height: 200px;
      padding: 0.5rem 1rem;
      border: none;
      outline: none;
      background: transparent;
      color: var(--text-primary);
      resize: none;
      font-family: inherit;
      font-size: 1rem;
      line-height: 1.5;
      overflow-y: auto;
      display: block;
      width: 100%;
      box-sizing: border-box;
      margin: 0;
    }

    .message-input::placeholder {
      color: var(--text-secondary);
      font-weight: 300;
    }

    .input-row {
      display: flex;
      align-items: flex-end;
      width: 100%;
      flex-shrink: 0;
      margin-top: 0.25rem;
    }

    .action-btn {
      border: none;
      padding: 0.625rem;
      border-radius: 18px;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 40px;
      height: 40px;
      flex-shrink: 0;
    }

    .mic-btn,
    .live-btn,
    .attach-btn {
      background: transparent;
      color: var(--text-secondary);
    }

    .mic-btn:hover,
    .live-btn:hover,
    .attach-btn:hover {
      background: var(--bg-hover);
      color: var(--text-secondary);
    }

    .mic-btn.listening {
      animation: glow 1.5s infinite ease-out;
      color: var(--accent-primary);
    }

    .send-btn {
      background: transparent;
      color: var(--text-secondary);
      display: none;
    }

    .send-btn:hover:not(:disabled) {
      background: var(--bg-hover);
      color: var(--text-primary);
    }

    .send-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    @keyframes glow {
      0% {
        box-shadow: 0 0 0 0 rgba(138, 180, 248, 0.4);
      }

      70% {
        box-shadow: 0 0 0 12px rgba(138, 180, 248, 0);
      }

      100% {
        box-shadow: 0 0 0 0 rgba(138, 180, 248, 0);
      }
    }

    .payment-form-container {
      background: var(--bg-hover);
      border: 1px solid var(--border-primary);
      border-radius: 12px;
      padding: 1.5rem;
      margin: 1rem 0;
      max-width: 500px;
    }


    .payment-form-title {
      color: var(--text-primary);
      font-size: 1.1rem;
      font-weight: 500;
      margin-bottom: 1rem;
    }


    .payment-form-subtitle {
      color: var(--text-tertiary);
      font-size: 0.9rem;
      margin-bottom: 1.5rem;
    }


    #card-element {
      background: var(--bg-input);
      border: 1px solid var(--border-primary);
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 1rem;
    }

    .card-errors {
      color: #f28b82;
      font-size: 0.875rem;
      margin-top: 0.5rem;
      min-height: 20px;
    }


    .pay-button {
      width: 100%;
      background: var(--accent-primary);
      color: var(--text-on-primary);
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      margin-top: 1rem;
    }

    /* Pay button text color fixes */
    .theme-c1 .pay-button,
    .theme-c2 .pay-button,
    .theme-c3 .pay-button,
    .theme-c7 .pay-button,
    .theme-c8 .pay-button,
    .theme-c9 .pay-button,
    .theme-c10 .pay-button,
    .theme-c11 .pay-button,
    .theme-c12 .pay-button,
    .theme-c13 .pay-button,
    .theme-c14 .pay-button,
    .theme-c15 .pay-button,
    .theme-c16 .pay-button,
    .theme-c19 .pay-button,
    .theme-c20 .pay-button,
    .theme-c21 .pay-button,
    .theme-c23 .pay-button,
    .theme-c24 .pay-button {
      color: #212121;
    }

    .theme-c4 .pay-button,
    .theme-c5 .pay-button,
    .theme-c6 .pay-button,
    .theme-c17 .pay-button,
    .theme-c18 .pay-button,
    .theme-c22 .pay-button {
      color: #ffffff;
    }

    .pay-button:hover:not(:disabled) {
      background: var(--accent-hover);
      transform: translateY(-1px);
    }

    .pay-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }



    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    body.chat-active .main-container {
      justify-content: flex-start;
    }

    body.chat-active .input-area {
      position: sticky;
      bottom: 0;
      z-index: 10;
      background: transparent;
    }

    .messages::-webkit-scrollbar {
      width: 4px;
    }

    .messages::-webkit-scrollbar-track {
      background: transparent;
    }

    .messages::-webkit-scrollbar-thumb {
      background: var(--bg-hover);
      border-radius: 2px;
    }


    @media (max-width: 768px) {
      .welcome-title {
        font-size: 2rem;
      }

      .header {
        padding: 1rem;
      }

      .messages {
        padding: 1rem;
      }

      .input-area {
        padding: 1rem;
      }
    }

    .attach-btn svg {
      transition: transform 0.2s ease-out;
    }

    .attach-btn:active svg {
      transform: rotate(45deg);
    }

    .drag-drop-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(33, 33, 33, 0.85);
      backdrop-filter: blur(5px);
      z-index: 9998;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s ease;
    }

    .drag-drop-overlay.visible {
      opacity: 1;
      pointer-events: all;
    }

    .drag-drop-message {
      color: var(--text-primary);
      font-size: 1.25rem;
      font-weight: 500;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1rem;
      border: 2px dashed #8ab4f8;
      border-radius: 12px;
      padding: 2rem 3rem;
      text-align: center;
    }

    /* Starter Prompts Section */
    .starter-prompts {
      padding: 0 1rem 1rem;
      max-width: 680px;
      margin: 0 auto;
      width: 100%;
      transition: opacity 0.3s ease, transform 0.3s ease;
    }

    .starter-prompts.hidden {
      display: none;
    }

    .starter-prompts.fade-in {
      animation: fadeInScale 0.3s ease-out forwards;
    }

    @keyframes fadeInScale {
      from {
        opacity: 0;
        transform: scale(0.95) translateY(10px);
      }

      to {
        opacity: 1;
        transform: scale(1) translateY(0);
      }
    }

    .prompt-categories {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 0.5rem;
      margin-bottom: 1rem;
      transition: opacity 0.3s ease, transform 0.3s ease;
    }

    .prompt-categories.hidden {
      opacity: 0;
      transform: translateY(-10px);
      pointer-events: none;
      height: 0;
      overflow: hidden;
      margin-bottom: 0;
    }

    .prompt-categories.fade-in {
      animation: fadeInCategories 0.3s ease-out forwards;
    }

    @keyframes fadeInCategories {
      from {
        opacity: 0;
        transform: scale(0.95) translateY(-10px);
        height: 0;
      }

      to {
        opacity: 1;
        transform: scale(1) translateY(0);
        height: auto;
      }
    }

    .prompt-category-btn {
      display: flex;
      align-items: center;
      gap: 0.375rem;
      padding: 0.5rem 0.75rem;
      height: 32px;
      background: var(--bg-input);
      border: 1px solid var(--border-primary);
      border-radius: 8px;
      color: var(--text-secondary);
      font-size: 0.875rem;
      cursor: pointer;
      transition: all 0.2s ease;
      white-space: nowrap;
      animation: fadeInButton 0.3s ease-out backwards;
    }

    /* Stagger animation for category buttons */
    .prompt-category-btn:nth-child(1) {
      animation-delay: 0.05s;
    }

    .prompt-category-btn:nth-child(2) {
      animation-delay: 0.1s;
    }

    .prompt-category-btn:nth-child(3) {
      animation-delay: 0.15s;
    }

    .prompt-category-btn:nth-child(4) {
      animation-delay: 0.2s;
    }

    .prompt-category-btn:nth-child(5) {
      animation-delay: 0.25s;
    }

    @keyframes fadeInButton {
      from {
        opacity: 0;
        transform: scale(0.9) translateY(-5px);
      }

      to {
        opacity: 1;
        transform: scale(1) translateY(0);
      }
    }

    .prompt-category-btn:hover {
      background: var(--bg-hover);
      border-color: var(--border-secondary);
      color: var(--text-primary);
    }

    .prompt-category-btn.active {
      background: var(--accent-primary);
      border-color: var(--accent-primary);
      color: var(--text-on-primary);
    }

    /* Fix text color for active buttons on light themes */
    .theme-c1 .prompt-category-btn.active,
    .theme-c2 .prompt-category-btn.active,
    .theme-c3 .prompt-category-btn.active,
    .theme-c7 .prompt-category-btn.active,
    .theme-c8 .prompt-category-btn.active,
    .theme-c9 .prompt-category-btn.active,
    .theme-c10 .prompt-category-btn.active,
    .theme-c11 .prompt-category-btn.active,
    .theme-c12 .prompt-category-btn.active,
    .theme-c13 .prompt-category-btn.active,
    .theme-c14 .prompt-category-btn.active,
    .theme-c15 .prompt-category-btn.active,
    .theme-c16 .prompt-category-btn.active,
    .theme-c19 .prompt-category-btn.active,
    .theme-c20 .prompt-category-btn.active,
    .theme-c21 .prompt-category-btn.active,
    .theme-c23 .prompt-category-btn.active,
    .theme-c24 .prompt-category-btn.active {
      color: #212121;
    }

    .theme-c4 .prompt-category-btn.active,
    .theme-c5 .prompt-category-btn.active,
    .theme-c6 .prompt-category-btn.active,
    .theme-c17 .prompt-category-btn.active,
    .theme-c18 .prompt-category-btn.active,
    .theme-c22 .prompt-category-btn.active {
      color: #ffffff;
    }

    .prompt-category-btn svg {
      width: 16px;
      height: 16px;
      flex-shrink: 0;
    }

    /* Prompt Options Container - Like Claude's dropdown */
    .prompt-options-container {
      position: relative;
      display: none;
      background: var(--bg-input);
      border: 1px solid var(--border-primary);
      border-radius: 12px;
      padding: 0.5rem;
      margin-top: 0.5rem;
    }

    .prompt-options-container.active {
      display: block;
      animation: slideDown 0.2s ease-out;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .prompt-options-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 0.75rem;
      border-bottom: 1px solid var(--border-primary);
      margin-bottom: 0.5rem;
    }

    .prompt-options-header svg {
      width: 16px;
      height: 16px;
      color: var(--text-tertiary);
    }

    .prompt-options-title {
      flex: 1;
      font-size: 0.75rem;
      color: var(--text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .prompt-options-close {
      background: transparent;
      border: none;
      color: var(--text-tertiary);
      cursor: pointer;
      padding: 0.25rem;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
      width: 24px;
      height: 24px;
    }

    .prompt-options-close:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
    }

    .prompt-options-close svg {
      width: 14px;
      height: 14px;
    }

    .prompt-options {
      display: flex;
      flex-direction: column;
      gap: 0;
    }

    .prompt-option {
      background: transparent;
      border: none;
      border-bottom: 1px solid var(--border-primary);
      border-radius: 0;
      padding: 0.625rem 0.75rem;
      color: var(--text-primary);
      font-size: 0.875rem;
      text-align: left;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .prompt-option:last-child {
      border-bottom: none;
    }

    .prompt-option:first-child {
      border-radius: 8px 8px 0 0;
    }

    .prompt-option:last-child {
      border-radius: 0 0 8px 8px;
    }

    .prompt-option:hover:not(:disabled) {
      background: var(--bg-hover);
    }

    .prompt-option:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .prompt-option::before {
      display: none;
    }

    .prompt-option-arrow {
      margin-left: auto;
      width: 16px;
      height: 16px;
      color: var(--text-tertiary);
      opacity: 0;
      transition: opacity 0.2s ease;
    }

    .prompt-option:hover .prompt-option-arrow {
      opacity: 1;
    }

    .coming-soon-badge {
      margin-left: auto;
      padding: 0.125rem 0.5rem;
      background: var(--bg-hover);
      border-radius: 4px;
      font-size: 0.75rem;
      color: var(--text-tertiary);
    }

    @media (max-width: 768px) {
      .prompt-categories {
        gap: 0.375rem;
      }

      .prompt-category-btn {
        font-size: 0.8125rem;
        padding: 0.375rem 0.625rem;
      }
    }
  </style>
</head>

<body>
  <div class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <button class="menu-btn desktop-menu-btn" id="menuBtnDesktop" title="Menu">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
          stroke-linecap="round" stroke-linejoin="round">
          <line x1="3" y1="12" x2="21" y2="12"></line>
          <line x1="3" y1="6" x2="21" y2="6"></line>
          <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
      </button>
    </div>
    <div class="sidebar-content">
      <nav class="sidebar-nav">
        <button class="sidebar-link" onclick="location.reload()">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round">
            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
          </svg>
          <span>New chat</span>
        </button>
      </nav>

      <div class="sidebar-footer">
        <div class="dropup-container">
          <button class="sidebar-link" id="settingsBtn">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
              stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="3"></circle>
              <path
                d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
              </path>
            </svg>
            <span>Settings</span>
          </button>

          <div class="dropup-menu" id="settingsDropup">
            <div>
              <button class="dropup-item" id="darkThemeBtn" data-theme="dark">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                  stroke-linecap="round" stroke-linejoin="round">
                  <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                </svg>
                <span>Dark</span>
              </button>
              <button class="dropup-item" id="lightThemeBtn" data-theme="light-theme">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                  stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="12" cy="12" r="5"></circle>
                  <line x1="12" y1="1" x2="12" y2="3"></line>
                  <line x1="12" y1="21" x2="12" y2="23"></line>
                  <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                  <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                  <line x1="1" y1="12" x2="3" y2="12"></line>
                  <line x1="21" y1="12" x2="23" y2="12"></line>
                  <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                  <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                </svg>
                <span>Light</span>
              </button>
            </div>
            <div class="dropup-divider"></div>
            <div class="theme-selector">
              <!-- Row 1 -->
              <button class="theme-button" id="theme-btn-c1" data-theme="theme-c1" title="Color 1"></button>
              <button class="theme-button" id="theme-btn-c2" data-theme="theme-c2" title="Color 2"></button>
              <button class="theme-button" id="theme-btn-c3" data-theme="theme-c3" title="Color 3"></button>
              <!-- Row 2 -->
              <button class="theme-button" id="theme-btn-c4" data-theme="theme-c4" title="Color 4"></button>
              <button class="theme-button" id="theme-btn-c5" data-theme="theme-c5" title="Color 5"></button>
              <button class="theme-button" id="theme-btn-c6" data-theme="theme-c6" title="Color 6"></button>
              <!-- Row 3 -->
              <button class="theme-button" id="theme-btn-c7" data-theme="theme-c7" title="Color 7"></button>
              <button class="theme-button" id="theme-btn-c8" data-theme="theme-c8" title="Color 8"></button>
              <button class="theme-button" id="theme-btn-c9" data-theme="theme-c9" title="Color 9"></button>
              <!-- Row 4 -->
              <button class="theme-button" id="theme-btn-c10" data-theme="theme-c10" title="Color 10"></button>
              <button class="theme-button" id="theme-btn-c11" data-theme="theme-c11" title="Color 11"></button>
              <button class="theme-button" id="theme-btn-c12" data-theme="theme-c12" title="Color 12"></button>
              <!-- Row 5 -->
              <button class="theme-button" id="theme-btn-c13" data-theme="theme-c13" title="Color 13"></button>
              <button class="theme-button" id="theme-btn-c14" data-theme="theme-c14" title="Color 14"></button>
              <button class="theme-button" id="theme-btn-c15" data-theme="theme-c15" title="Color 15"></button>
              <!-- Row 6 -->
              <button class="theme-button" id="theme-btn-c16" data-theme="theme-c16" title="Color 16"></button>
              <button class="theme-button" id="theme-btn-c17" data-theme="theme-c17" title="Color 17"></button>
              <button class="theme-button" id="theme-btn-c18" data-theme="theme-c18" title="Color 18"></button>
              <!-- Row 7 -->
              <button class="theme-button" id="theme-btn-c19" data-theme="theme-c19" title="Color 19"></button>
              <button class="theme-button" id="theme-btn-c20" data-theme="theme-c20" title="Color 20"></button>
              <button class="theme-button" id="theme-btn-c21" data-theme="theme-c21" title="Color 21"></button>
              <!-- Row 8 -->
              <button class="theme-button" id="theme-btn-c22" data-theme="theme-c22" title="Color 22"></button>
              <button class="theme-button" id="theme-btn-c23" data-theme="theme-c23" title="Color 23"></button>
              <button class="theme-button" id="theme-btn-c24" data-theme="theme-c24" title="Color 24"></button>
            </div>
            <div class="dropup-divider"></div>
            <button class="dropup-item" id="integrationOption">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <path d="M4 7h16"></path>
                <path d="M4 12h16"></path>
                <path d="M4 17h16"></path>
              </svg>
              <span>Integration</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="sidebar-overlay" id="sidebarOverlay"></div>

  <!-- Settings Modal -->
  <div class="settings-modal" id="settingsModal">
    <div class="settings-content">
      <div class="settings-header">
        <h2>Integration Settings</h2>
        <button class="settings-close" id="settingsCloseBtn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>

      <div class="settings-body">
        <!-- Apollo.io Section -->
        <div class="settings-section">
          <div class="settings-section-title">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round">
              <path
                d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z">
              </path>
              <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
              <line x1="12" y1="22.08" x2="12" y2="12"></line>
            </svg>
            Apollo.io
          </div>
          <div class="settings-section-desc">
            Connect your Apollo.io account to enrich sponsor data and find leads.
          </div>

          <div class="form-group">
            <label class="form-label">API Key</label>
            <input type="password" class="form-input" id="apolloApiKey" placeholder="Enter your Apollo.io API key"
              autocomplete="off" />
          </div>
        </div>

        <!-- Clay Section -->
        <div class="settings-section">
          <div class="settings-section-title">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round">
              <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
              <circle cx="8.5" cy="8.5" r="1.5"></circle>
              <polyline points="21 15 16 10 5 21"></polyline>
            </svg>
            Clay
          </div>
          <div class="settings-section-desc">
            Connect Clay to automate data enrichment and workflows.
          </div>

          <div class="form-group">
            <label class="form-label">API Key</label>
            <input type="password" class="form-input" id="clayApiKey" placeholder="Enter your Clay API key"
              autocomplete="off" />
          </div>
        </div>

        <!-- HubSpot Section -->
        <div class="settings-section">
          <div class="settings-section-title">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"></circle>
              <circle cx="12" cy="12" r="4"></circle>
              <line x1="4.93" y1="4.93" x2="9.17" y2="9.17"></line>
              <line x1="14.83" y1="14.83" x2="19.07" y2="19.07"></line>
              <line x1="14.83" y1="9.17" x2="19.07" y2="4.93"></line>
              <line x1="14.83" y1="9.17" x2="18.36" y2="5.64"></line>
              <line x1="4.93" y1="19.07" x2="9.17" y2="14.83"></line>
            </svg>
            HubSpot
          </div>
          <div class="settings-section-desc">
            Connect your HubSpot account to sync contacts and manage relationships.
          </div>

          <div class="connection-status" id="hubspotStatus">
            <span class="status-indicator"></span>
            <span class="status-text">Not connected</span>
          </div>

          <button class="oauth-button" id="hubspotConnectBtn">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"></circle>
              <circle cx="12" cy="12" r="4"></circle>
              <line x1="4.93" y1="4.93" x2="9.17" y2="9.17"></line>
              <line x1="14.83" y1="14.83" x2="19.07" y2="19.07"></line>
              <line x1="14.83" y1="9.17" x2="19.07" y2="4.93"></line>
              <line x1="14.83" y1="9.17" x2="18.36" y2="5.64"></line>
              <line x1="4.93" y1="19.07" x2="9.17" y2="14.83"></line>
            </svg>
            <span>Connect HubSpot</span>
          </button>
        </div>
      </div>

      <div class="settings-actions">
        <button class="btn-secondary" id="settingsCancelBtn">Cancel</button>
        <button class="btn-primary" id="settingsSaveBtn">Save Settings</button>
      </div>
    </div>
  </div>

  <div class="header">
    <div class="header-left">
      <button class="menu-btn mobile-menu-btn" id="menuBtn" title="Menu">
        <svg class="icon-menu" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
          stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="3" y1="12" x2="21" y2="12"></line>
          <line x1="3" y1="6" x2="21" y2="6"></line>
          <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
        <svg class="icon-arrow" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
          stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
          <line x1="19" y1="12" x2="5" y2="12"></line>
          <polyline points="12 19 5 12 12 5"></polyline>
        </svg>
      </button>
      <div class="header-info">
        <h1 class="jelly-logo" onclick="location.reload()">
          <span>E</span><span>v</span><span>e</span><span>n</span><span>t</span><span>s</span>
        </h1>
      </div>
    </div>
  </div>

  <div class="main-container">
    <div class="welcome-screen" id="welcomeScreen">
      <h1 class="welcome-title">Hello, there!</h1>
    </div>

    <div class="messages" id="messages"></div>

    <div class="input-area" id="inputArea">
      <div class="input-wrapper">
        <input type="file" id="fileInput" accept="image/*,application/pdf,text/plain,.docx,.pptx" multiple
          style="display: none;" />

        <div class="input-container">
          <div class="file-preview-container" id="filePreviewContainer"></div>

          <div class="textarea-wrapper">
            <textarea id="messageInput" class="message-input" placeholder="Ask events..." rows="1"></textarea>
          </div>

          <div class="input-row">
            <button class="action-btn attach-btn" id="attachBtn" title="Attach file">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg>
            </button>

            <div style="flex: 1;"></div>

            <button class="action-btn mic-btn" id="micBtn" title="Voice to text">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                <path
                  d="M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.49 6-3.31 6-6.72h-1.7z" />
              </svg>
            </button>

            <button class="action-btn live-btn" id="liveBtn" title="Start live conversation">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <line x1="6" y1="10" x2="6" y2="14"></line>
                <line x1="10" y1="4" x2="10" y2="20"></line>
                <line x1="14" y1="8" x2="14" y2="16"></line>
                <line x1="18" y1="11" x2="18" y2="13"></line>
              </svg>
            </button>

            <button class="action-btn send-btn" onclick="sendMessage()" id="sendBtn" title="Send">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <line x1="22" y1="2" x2="11" y2="13"></line>
                <polygon points="22,2 15,22 11,13 2,9"></polygon>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- Starter Prompts Section -->
    <div class="starter-prompts" id="starterPrompts">
      <div class="prompt-categories" id="promptCategories">
        <button class="prompt-category-btn" data-category="ideas">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 256 256">
            <path
              d="M176,232a8,8,0,0,1-8,8H88a8,8,0,0,1,0-16h80A8,8,0,0,1,176,232Zm40-128a87.55,87.55,0,0,1-33.64,69.21A16.24,16.24,0,0,0,176,186v6a16,16,0,0,1-16,16H96a16,16,0,0,1-16-16v-6a16,16,0,0,0-6.23-12.66A87.59,87.59,0,0,1,40,104.49C39.74,56.83,78.26,17.14,125.88,16A88,88,0,0,1,216,104Zm-16,0a72,72,0,0,0-73.74-72c-39,.92-70.47,33.39-70.26,72.39a71.65,71.65,0,0,0,27.64,56.3A32,32,0,0,1,96,186v6h64v-6a32.15,32.15,0,0,1,12.47-25.35A71.65,71.65,0,0,0,200,104Zm-16.11-9.34a57.6,57.6,0,0,0-46.56-46.55,8,8,0,0,0-2.66,15.78c16.57,2.79,30.63,16.85,33.44,33.45A8,8,0,0,0,176,104a9,9,0,0,0,1.35-.11A8,8,0,0,0,183.89,94.66Z">
            </path>
          </svg>
          Get Ideas
        </button>

        <button class="prompt-category-btn" data-category="images">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 256 256">
            <path
              d="M227.31,73.37,182.63,28.68a16,16,0,0,0-22.63,0L36.69,152A15.86,15.86,0,0,0,32,163.31V208a16,16,0,0,0,16,16H92.69A15.86,15.86,0,0,0,104,219.31L227.31,96a16,16,0,0,0,0-22.63ZM92.69,208H48V163.31l88-88L180.69,120ZM192,108.68,147.31,64l24-24L216,84.68Z">
            </path>
          </svg>
          Create Images
        </button>

        <button class="prompt-category-btn" data-category="video">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 256 256">
            <path
              d="M164.44,121.34l-48-32A8,8,0,0,0,104,96v64a8,8,0,0,0,12.44,6.66l48-32a8,8,0,0,0,0-13.32ZM120,145.05V111l25.58,17ZM216,40H40A16,16,0,0,0,24,56V168a16,16,0,0,0,16,16H216a16,16,0,0,0,16-16V56A16,16,0,0,0,216,40Zm0,128H40V56H216V168Zm16,40a8,8,0,0,1-8,8H32a8,8,0,0,1,0-16H224A8,8,0,0,1,232,208Z">
            </path>
          </svg>
          Create Video
        </button>

        <button class="prompt-category-btn" data-category="plan">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 256 256">
            <path
              d="M208,32H184V24a8,8,0,0,0-16,0v8H88V24a8,8,0,0,0-16,0v8H48A16,16,0,0,0,32,48V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V48A16,16,0,0,0,208,32ZM72,48v8a8,8,0,0,0,16,0V48h80v8a8,8,0,0,0,16,0V48h24V80H48V48ZM208,208H48V96H208V208Z">
            </path>
          </svg>
          Plan Event
        </button>

        <button class="prompt-category-btn" data-category="sponsor">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 256 256">
            <path
              d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm40-68a28,28,0,0,1-28,28h-4v8a8,8,0,0,1-16,0v-8H104a8,8,0,0,1,0-16h36a12,12,0,0,0,0-24H116a28,28,0,0,1,0-56h4V72a8,8,0,0,1,16,0v8h16a8,8,0,0,1,0,16H116a12,12,0,0,0,0,24h24A28,28,0,0,1,168,148Z">
            </path>
          </svg>
          Sponsor
        </button>
      </div>

      <!-- Single Options Container -->
      <div class="prompt-options-container" id="promptOptionsContainer">
        <div class="prompt-options-header">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 256 256"
            id="categoryIcon">
            <path
              d="M176,232a8,8,0,0,1-8,8H88a8,8,0,0,1,0-16h80A8,8,0,0,1,176,232Zm40-128a87.55,87.55,0,0,1-33.64,69.21A16.24,16.24,0,0,0,176,186v6a16,16,0,0,1-16,16H96a16,16,0,0,1-16-16v-6a16,16,0,0,0-6.23-12.66A87.59,87.59,0,0,1,40,104.49C39.74,56.83,78.26,17.14,125.88,16A88,88,0,0,1,216,104Zm-16,0a72,72,0,0,0-73.74-72c-39,.92-70.47,33.39-70.26,72.39a71.65,71.65,0,0,0,27.64,56.3A32,32,0,0,1,96,186v6h64v-6a32.15,32.15,0,0,1,12.47-25.35A71.65,71.65,0,0,0,200,104Zm-16.11-9.34a57.6,57.6,0,0,0-46.56-46.55,8,8,0,0,0-2.66,15.78c16.57,2.79,30.63,16.85,33.44,33.45A8,8,0,0,0,176,104a9,9,0,0,0,1.35-.11A8,8,0,0,0,183.89,94.66Z">
            </path>
          </svg>
          <span class="prompt-options-title" id="categoryTitle">Get Ideas</span>
          <button class="prompt-options-close" id="closePromptOptions">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 256 256">
              <path
                d="M205.66,194.34a8,8,0,0,1-11.32,11.32L128,139.31,61.66,205.66a8,8,0,0,1-11.32-11.32L116.69,128,50.34,61.66A8,8,0,0,1,61.66,50.34L128,116.69l66.34-66.35a8,8,0,0,1,11.32,11.32L139.31,128Z">
              </path>
            </svg>
          </button>
        </div>
        <div class="prompt-options" id="promptOptionsList">
          <!-- Options will be dynamically inserted here -->
        </div>
      </div>
    </div>
  </div>
  <div id="dragDropOverlay" class="drag-drop-overlay">
    <div class="drag-drop-message">
      <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
        stroke-linecap="round" stroke-linejoin="round">
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
        <polyline points="17 8 12 3 7 8"></polyline>
        <line x1="12" y1="3" x2="12" y2="15"></line>
      </svg>
      <span>Drop files to attach</span>
    </div>
  </div>

  <script>
    // ========================================
    // CONFIGURATION
    // ========================================
    const CONFIG = {
      PROD_ADK_SERVER_URL: 'https://adk-backend-service-766291037876.us-central1.run.app',
      PROD_SERVICES_API_URL: 'https://services-backend-766291037876.us-central1.run.app',
      LOCAL_ADK_SERVER_URL: 'http://localhost:8000',
      LOCAL_SERVICES_API_URL: 'http://localhost:8001',
      STRIPE_PUBLISHABLE_KEY: 'pk_test_51SFiGIHRBWNtQGKsXBP2PDJE5iPhriiCZBQW5QESdTgOSoFCTEdM1eiNdQXNSbkFqNcsoVdCMYqXJLtf0C0v3S4h00SLYyRXU4',
      APP_NAME: 'chat_with_human'
    };

    // Define all available themes
    const THEMES = [
      "dark",
      "light-theme",
      "theme-c1", "theme-c2", "theme-c3", "theme-c4", "theme-c5", "theme-c6",
      "theme-c7", "theme-c8", "theme-c9", "theme-c10", "theme-c11", "theme-c12",
      "theme-c13", "theme-c14", "theme-c15", "theme-c16", "theme-c17", "theme-c18",
      "theme-c19", "theme-c20", "theme-c21", "theme-c22", "theme-c23", "theme-c24"
    ];

    const isLocal = window.location.hostname === 'localhost' ||
      window.location.hostname === '127.0.0.1' ||
      window.location.hostname === '' ||
      window.location.port === '8080';

    const ADK_SERVER_URL = isLocal ? CONFIG.LOCAL_ADK_SERVER_URL : CONFIG.PROD_ADK_SERVER_URL;
    const SERVICES_API = isLocal ? CONFIG.LOCAL_SERVICES_API_URL : CONFIG.PROD_SERVICES_API_URL;
    const STRIPE_PUBLISHABLE_KEY = CONFIG.STRIPE_PUBLISHABLE_KEY;
    const APP_NAME = CONFIG.APP_NAME;
    const USER_ID = 'demo_user';
    const SESSION_ID = 'default_session';

    console.log(' Environment Detection:');
    console.log('  - Hostname:', window.location.hostname);
    console.log('  - Port:', window.location.port);
    console.log('  - Is Local:', isLocal);
    console.log('  - ADK Server:', ADK_SERVER_URL);
    console.log('  - Services API:', SERVICES_API);

    // ========================================
    // DOM ELEMENTS - Initialize after page loads
    // ========================================
    let settingsModal, settingsBtn, settingsCloseBtn, settingsCancelBtn, settingsSaveBtn;
    let hubspotConnectBtn, hubspotStatus, apolloApiKeyInput, clayApiKeyInput;

    function initializeSettingsElements() {
      settingsModal = document.getElementById('settingsModal');
      settingsBtn = document.getElementById('settingsBtn');
      settingsCloseBtn = document.getElementById('settingsCloseBtn');
      settingsCancelBtn = document.getElementById('settingsCancelBtn');
      settingsSaveBtn = document.getElementById('settingsSaveBtn');
      hubspotConnectBtn = document.getElementById('hubspotConnectBtn');
      hubspotStatus = document.getElementById('hubspotStatus');
      apolloApiKeyInput = document.getElementById('apolloApiKey');
      clayApiKeyInput = document.getElementById('clayApiKey');

      console.log(' Settings elements initialized:', {
        settingsBtn: settingsBtn ? '' : '',
        settingsModal: settingsModal ? '' : '',
        settingsCloseBtn: settingsCloseBtn ? '' : '',
        hubspotConnectBtn: hubspotConnectBtn ? '' : ''
      });

      // Add event listeners
      if (settingsBtn) {
        const settingsDropup = document.getElementById('settingsDropup');
        const integrationOption = document.getElementById('integrationOption');

        // Toggle dropup menu on settings button click
        settingsBtn.addEventListener('click', function (e) {
          console.log(' Settings button clicked!');
          e.preventDefault();
          e.stopPropagation();
          settingsDropup.classList.toggle('active');
        });

        // Theme buttons
        document.getElementById('darkThemeBtn').addEventListener('click', (e) => {
          e.preventDefault();
          e.stopPropagation();
          setTheme('dark');
        });
        document.getElementById('lightThemeBtn').addEventListener('click', (e) => {
          e.preventDefault();
          e.stopPropagation();
          setTheme('light-theme');
        });

        document.querySelectorAll('.theme-button').forEach(button => {
          button.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            const themeName = e.target.getAttribute('data-theme');
            setTheme(themeName);
          });
        });

        // Integration option - open settings modal
        if (integrationOption) {
          integrationOption.addEventListener('click', function (e) {
            e.preventDefault();
            e.stopPropagation();
            settingsDropup.classList.remove('active');
            openSettingsModal();
          });
        }

        // Close dropup when clicking outside
        document.addEventListener('click', function (e) {
          if (settingsDropup && !settingsBtn.contains(e.target) && !settingsDropup.contains(e.target)) {
            settingsDropup.classList.remove('active');
          }
        });

        console.log(' Settings button and dropup listeners attached');
      } else {
        console.error(' Cannot attach listener - settingsBtn is null');
      }

      if (settingsCloseBtn) settingsCloseBtn.addEventListener('click', closeSettingsModal);
      if (settingsCancelBtn) settingsCancelBtn.addEventListener('click', closeSettingsModal);
      if (settingsSaveBtn) settingsSaveBtn.addEventListener('click', saveSettings);
      if (hubspotConnectBtn) hubspotConnectBtn.addEventListener('click', handleHubspotConnect);

      if (settingsModal) {
        settingsModal.addEventListener('click', (e) => {
          if (e.target === settingsModal) {
            closeSettingsModal();
          }
        });
      }
    }

    // ========================================
    // SETTINGS FUNCTIONS
    // ========================================
    function openSettingsModal() {
      console.log(' Opening settings modal...');
      if (!settingsModal) {
        console.error(' settingsModal is null!');
        return;
      }
      loadSettings();
      checkHubspotConnection();
      settingsModal.classList.add('active');
      console.log(' Modal opened, classes:', settingsModal.className);
    }

    function closeSettingsModal() {
      console.log(' Closing settings modal...');
      if (settingsModal) {
        settingsModal.classList.remove('active');
      }
    }

    function loadSettings() {
      const apolloKey = localStorage.getItem('apollo_api_key');
      const clayKey = localStorage.getItem('clay_api_key');

      if (apolloApiKeyInput && apolloKey) apolloApiKeyInput.value = apolloKey;
      if (clayApiKeyInput && clayKey) clayApiKeyInput.value = clayKey;
    }

    function saveSettings() {
      const apolloKey = apolloApiKeyInput ? apolloApiKeyInput.value.trim() : '';
      const clayKey = clayApiKeyInput ? clayApiKeyInput.value.trim() : '';

      if (apolloKey) {
        localStorage.setItem('apollo_api_key', apolloKey);
      } else {
        localStorage.removeItem('apollo_api_key');
      }

      if (clayKey) {
        localStorage.setItem('clay_api_key', clayKey);
      } else {
        localStorage.removeItem('clay_api_key');
      }

      closeSettingsModal();
      console.log(' Settings saved successfully');
    }

    function updateHubspotStatus(isConnected) {
      if (!hubspotStatus) return;

      const indicator = hubspotStatus.querySelector('.status-indicator');
      const text = hubspotStatus.querySelector('.status-text');

      if (isConnected) {
        indicator.classList.add('connected');
        text.classList.add('connected');
        text.textContent = 'Connected';

        if (hubspotConnectBtn) {
          hubspotConnectBtn.classList.add('connected');
          hubspotConnectBtn.querySelector('span').textContent = 'Disconnect HubSpot';
        }
      } else {
        indicator.classList.remove('connected');
        text.classList.remove('connected');
        text.textContent = 'Not connected';

        if (hubspotConnectBtn) {
          hubspotConnectBtn.classList.remove('connected');
          hubspotConnectBtn.querySelector('span').textContent = 'Connect HubSpot';
        }
      }
    }

    async function checkHubspotConnection() {
      try {
        const response = await fetch(`${SERVICES_API}/oauth/status?user_id=demo_user`);

        if (!response.ok) {
          throw new Error(`Server responded with status ${response.status}`);
        }

        const data = await response.json();

        if (data.connections && data.connections.hubspot) {
          localStorage.setItem('hubspot_connected', 'true');
          updateHubspotStatus(true);
        } else {
          localStorage.removeItem('hubspot_connected');
          updateHubspotStatus(false);
        }
      } catch (error) {
        console.warn('Could not check HubSpot status:', error.message);
        console.log('This can happen due to network issues or if the backend service is offline. The app will continue to function.');
        updateHubspotStatus(false);
      }
    }

    function handleHubspotConnect() {
      const isConnected = localStorage.getItem('hubspot_connected') === 'true';

      if (isConnected) {
        // Disconnect
        if (confirm('Are you sure you want to disconnect HubSpot?')) {
          fetch(`${SERVICES_API}/oauth/disconnect/hubspot?user_id=demo_user`, {
            method: 'POST'
          })
            .then(response => response.json())
            .then(data => {
              localStorage.removeItem('hubspot_connected');
              localStorage.removeItem('hubspot_token');
              updateHubspotStatus(false);
              console.log(' HubSpot disconnected');
              if (typeof addMessage === 'function') {
                addMessage(' HubSpot disconnected successfully', 'assistant');
              }
            })
            .catch(error => {
              console.error('Error disconnecting HubSpot:', error);
              alert('Failed to disconnect HubSpot');
            });
        }
      } else {
        // Connect - Redirect to OAuth flow
        console.log(' Initiating HubSpot OAuth...');
        closeSettingsModal();
        const oauthUrl = `${SERVICES_API}/oauth/hubspot/authorize?user_id=demo_user`;
        console.log(' Redirecting to:', oauthUrl);
        window.location.href = oauthUrl;
      }
    }

    // ========================================
    // INITIALIZE SETTINGS ON PAGE LOAD
    // ========================================
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initializeSettingsElements);
    } else {
      initializeSettingsElements();
    }

    // ========================================
    // REST OF THE APPLICATION CODE
    // ========================================
    const welcomeScreen = document.getElementById('welcomeScreen');
    const messagesContainer = document.getElementById('messages');
    const messageInput = document.getElementById('messageInput');
    const sendBtn = document.getElementById('sendBtn');
    const micBtn = document.getElementById('micBtn');
    const liveBtn = document.getElementById('liveBtn');
    const menuBtn = document.getElementById('menuBtn');
    const sidebarOverlay = document.getElementById('sidebarOverlay');
    const menuBtnDesktop = document.getElementById('menuBtnDesktop');
    const attachBtn = document.getElementById('attachBtn');
    const fileInput = document.getElementById('fileInput');
    const filePreviewContainer = document.getElementById('filePreviewContainer');

    let stripe = null;
    let elements = null;
    let cardElement = null;
    let currentCartId = null;
    let currentClientSecret = null;
    let attachedFiles = [];

    function initializeStripe() {
      if (!stripe) {
        stripe = Stripe(STRIPE_PUBLISHABLE_KEY);
      }
    }

    // --- Theme Functions ---

    function setTheme(themeName) {
      // Remove all possible theme classes
      THEMES.forEach(theme => document.body.classList.remove(theme));

      // Add the new theme class (if it's not the default dark theme)
      if (themeName !== 'dark') {
        document.body.classList.add(themeName);
      }

      localStorage.setItem('theme', themeName);
    }

    function loadTheme() {
      const savedTheme = localStorage.getItem('theme');

      if (savedTheme && THEMES.includes(savedTheme)) {
        setTheme(savedTheme);
      } else {
        // Default to dark theme if no valid theme is saved
        setTheme('dark');
      }
    }

    function updateInputButtons() {
      const hasText = messageInput.value.trim().length > 0;
      const hasFiles = attachedFiles.length > 0;

      // Attach button is always visible
      attachBtn.style.display = 'flex';
      attachBtn.title = 'Attach file';

      // Show send button only if there's text or files
      // Otherwise show mic and live buttons
      if (hasText || hasFiles) {
        sendBtn.style.display = 'flex';
        sendBtn.disabled = false;
        micBtn.style.display = 'none';
        liveBtn.style.display = 'none';
      } else {
        sendBtn.style.display = 'none';
        micBtn.style.display = 'flex';
        liveBtn.style.display = 'flex';
      }
    }

    messageInput.addEventListener('input', function () {
      this.style.height = 'auto';
      this.style.height = Math.min(this.scrollHeight, 200) + 'px';
      updateInputButtons();
    });

    messageInput.addEventListener('keydown', function (event) {
      if (event.key === 'Enter' && !event.shiftKey) {
        event.preventDefault();
        if (messageInput.value.trim().length > 0 || attachedFiles.length > 0) {
          sendMessage();
        }
      }
    });

    function toggleSidebar() {
      const isDesktop = window.innerWidth >= 1024;
      if (isDesktop) {
        document.body.classList.toggle('sidebar-closed');
      } else {
        document.body.classList.toggle('sidebar-open');
      }
    }

    menuBtn.addEventListener('click', toggleSidebar);
    menuBtnDesktop.addEventListener('click', toggleSidebar);
    sidebarOverlay.addEventListener('click', toggleSidebar);

    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (SpeechRecognition) {
      const recognition = new SpeechRecognition();
      recognition.continuous = false;
      recognition.lang = 'en-US';

      micBtn.addEventListener('click', () => {
        recognition.start();
      });

      recognition.onstart = () => {
        micBtn.classList.add('listening');
      };

      recognition.onend = () => {
        micBtn.classList.remove('listening');
      };

      recognition.onerror = (event) => {
        console.error("Speech recognition error:", event.error);
        micBtn.classList.remove('listening');
      };

      recognition.onresult = (event) => {
        const transcript = event.results[event.results.length - 1][0].transcript.trim();
        messageInput.value = transcript;
        messageInput.dispatchEvent(new Event('input'));
      };
    } else {
      micBtn.style.display = 'none';
    }

    attachBtn.addEventListener('click', () => {
      fileInput.click();
    });

    fileInput.addEventListener('change', (event) => {
      const files = Array.from(event.target.files);
      if (files.length > 0) {
        attachedFiles = [...attachedFiles, ...files];
        showFilePreview();
        updateInputButtons();
      }
      event.target.value = null;
    });

    function showFilePreview() {
      filePreviewContainer.innerHTML = '';

      attachedFiles.forEach((file, index) => {
        let previewHtml = '';
        const fileSize = (file.size / 1024 / 1024).toFixed(2);

        if (file.type.startsWith('image/')) {
          const objectUrl = URL.createObjectURL(file);
          previewHtml = `
                        <img src="${objectUrl}" alt="Preview" />
                        <div class="file-info">
                            <span class="file-name">${file.name}</span>
                            <span class="file-size">${fileSize} MB</span>
                        </div>
                    `;
        } else {
          previewHtml = `
                        <span></span>
                        <div class="file-info">
                            <span class="file-name">${file.name}</span>
                            <span class="file-size">${fileSize} MB</span>
                        </div>
                    `;
        }

        const previewItem = document.createElement('div');
        previewItem.className = 'file-preview-item';
        previewItem.innerHTML = `
                    ${previewHtml}
                    <button class="file-preview-remove" onclick="removeAttachedFile(${index})">&times;</button>
                `;
        filePreviewContainer.appendChild(previewItem);
      });
      filePreviewContainer.style.display = attachedFiles.length > 0 ? 'flex' : 'none';
    }

    function removeAttachedFile(index) {
      if (index === undefined) {
        attachedFiles = [];
      } else {
        attachedFiles.splice(index, 1);
      }
      showFilePreview();
      updateInputButtons();
    }

    function fileToBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result.split(',')[1]);
        reader.onerror = (error) => reject(error);
      });
    }

    liveBtn.addEventListener('click', () => {
      window.location.href = 'live.html';
    });

    function switchToChatView() {
      welcomeScreen.classList.add('hidden');
      messagesContainer.classList.add('active');
      document.body.classList.add('chat-active');
      setTimeout(() => {
        welcomeScreen.style.display = 'none';
      }, 500);
    }

    function addMessage(content, type, files = null, showAvatar = true) {
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${type}`;

      if (showAvatar) {
        const avatar = document.createElement('div');
        avatar.className = 'avatar';
        avatar.textContent = type === 'user' ? 'You' : 'ES';
        messageDiv.appendChild(avatar);
      }

      const messageContent = document.createElement('div');
      messageContent.className = 'message-content';

      if (files && files.length > 0) {
        messageContent.classList.add('with-attachments');

        const attachmentsDiv = document.createElement('div');
        attachmentsDiv.className = 'message-attachments';

        files.forEach(file => {
          const attachmentDiv = document.createElement('div');
          attachmentDiv.className = 'message-attachment';

          if (file.type.startsWith('image/')) {
            const img = document.createElement('img');
            img.src = URL.createObjectURL(file);
            img.alt = file.name;
            attachmentDiv.appendChild(img);
          } else {
            attachmentDiv.innerHTML = `<span></span><span>${file.name}</span>`;
          }
          attachmentsDiv.appendChild(attachmentDiv);
        });

        messageContent.appendChild(attachmentsDiv);
      }

      if (content) {
        const textDiv = document.createElement('div');
        textDiv.innerHTML = content.replace(/\n/g, '<br>');
        messageContent.appendChild(textDiv);
      }

      messageDiv.appendChild(messageContent);
      messagesContainer.appendChild(messageDiv);
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
      return messageDiv;
    }

    function addPaymentForm(cartId, clientSecret, cartSummary) {
      initializeStripe();

      currentCartId = cartId;
      currentClientSecret = clientSecret;

      const formContainer = document.createElement('div');
      formContainer.className = 'message assistant';

      const avatar = document.createElement('div');
      avatar.className = 'avatar';
      avatar.textContent = 'ES';

      const formContent = document.createElement('div');
      formContent.className = 'message-content';

      formContent.innerHTML = `
        <div class="payment-form-container">
            <div class="payment-form-title"> Enter Payment Details</div>
            <div class="payment-form-subtitle">
                Sponsorship: ${cartSummary.tier} - ${cartSummary.amount}<br>
                Event: ${cartSummary.event}
            </div>
            <div id="card-element"></div>
            <div id="card-errors" class="card-errors"></div>
            <button id="pay-button" class="pay-button">
                Pay ${cartSummary.amount}
            </button>
        </div>
    `;

      formContainer.appendChild(avatar);
      formContainer.appendChild(formContent);
      messagesContainer.appendChild(formContainer);
      messagesContainer.scrollTop = messagesContainer.scrollHeight;

      setTimeout(() => {
        const isDark = !document.body.classList.contains('light-theme');
        elements = stripe.elements({
          clientSecret: clientSecret,
          appearance: {
            theme: isDark ? 'night' : 'stripe',
            variables: {
              colorPrimary: '#8ab4f8',
              colorBackground: isDark ? '#212121' : '#ffffff',
              colorText: isDark ? '#e8eaed' : '#202124',
              colorDanger: '#f28b82',
              fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto',
              spacingUnit: '4px',
              borderRadius: '8px'
            }
          }
        });

        cardElement = elements.create('payment');
        cardElement.mount('#card-element');

        cardElement.on('change', (event) => {
          const displayError = document.getElementById('card-errors');
          if (event.error) {
            displayError.textContent = event.error.message;
          } else {
            displayError.textContent = '';
          }
        });

        const payButton = document.getElementById('pay-button');
        payButton.addEventListener('click', handlePayment);
      }, 100);
    }

    async function handlePayment() {
      const payButton = document.getElementById('pay-button');
      const cardErrors = document.getElementById('card-errors');

      payButton.disabled = true;
      payButton.textContent = 'Processing...';
      cardErrors.textContent = '';

      try {
        const { error, paymentIntent } = await stripe.confirmPayment({
          elements,
          confirmParams: {
            return_url: window.location.href,
          },
          redirect: 'if_required'
        });

        if (error) {
          cardErrors.textContent = error.message;
          payButton.disabled = false;
          payButton.textContent = 'Try Again';
          return;
        }

        if (paymentIntent.status === 'succeeded') {
          const response = await fetch(`${SERVICES_API}/payments/confirm`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              cart_id: currentCartId,
              payment_method_id: paymentIntent.payment_method
            })
          });

          if (!response.ok) {
            throw new Error(`Server error: ${response.status}`);
          }

          const result = await response.json();

          if (result.success) {
            const messageElement = payButton.closest('.message');
            if (messageElement) {
              messageElement.remove();
            }
            addMessage(result.message, 'assistant');
          } else {
            throw new Error(result.message || 'Payment confirmation failed');
          }
        }

      } catch (err) {
        console.error('Payment error:', err);
        cardErrors.textContent = err.message || 'Payment failed. Please try again.';
        payButton.disabled = false;
        payButton.textContent = 'Try Again';
      }
    }

    function addLoading() {
      const loadingDiv = document.createElement('div');
      loadingDiv.className = 'loading-message';
      const avatar = document.createElement('div');
      avatar.className = 'avatar';
      avatar.textContent = 'ES';
      const loadingContent = document.createElement('div');
      loadingContent.className = 'loading-content';
      loadingContent.innerHTML = `<span>Thinking</span><div class="typing-indicator"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>`;
      loadingDiv.appendChild(avatar);
      loadingDiv.appendChild(loadingContent);
      messagesContainer.appendChild(loadingDiv);
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
      return loadingDiv;
    }

    async function ensureSession() {
      const sessionUrl = `${ADK_SERVER_URL}/apps/${APP_NAME}/users/${USER_ID}/sessions/${SESSION_ID}`;

      try {
        const response = await fetch(sessionUrl);
        if (response.ok) return true;
      } catch (e) { }

      try {
        const response = await fetch(sessionUrl, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ state: {} })
        });

        if (response.ok || response.status === 409) return true;
        throw new Error(`Session creation failed: ${response.status}`);
      } catch (error) {
        console.error(' Session error:', error);
        return false;
      }
    }

    async function sendMessage() {
      if (!await ensureSession()) {
        addMessage('Failed to create session. Please refresh the page.', 'assistant');
        return;
      }

      const message = messageInput.value.trim();
      const filesToSend = [...attachedFiles];

      if (!message && filesToSend.length === 0) {
        return;
      }

      if (sendBtn.disabled) return;
      sendBtn.disabled = true;

      if (!messagesContainer.classList.contains('active')) {
        switchToChatView();
      }

      const hasText = message.length > 0;
      const hasFiles = filesToSend.length > 0;

      if (hasText && hasFiles) {
        addMessage(null, 'user', filesToSend, false);
        addMessage(message, 'user', null, true);
      } else {
        addMessage(message, 'user', filesToSend, true);
      }

      messageInput.value = '';
      messageInput.dispatchEvent(new Event('input'));
      removeAttachedFile();

      const loadingElement = addLoading();

      try {
        const parts = [];

        for (const file of filesToSend) {
          console.log(' File to send:', { name: file.name, type: file.type, size: file.size });
          const base64data = await fileToBase64(file);
          console.log(' Base64 data length:', base64data.length);
          parts.push({ "inline_data": { "mime_type": file.type, "data": base64data } });
        }

        if (message) {
          parts.push({ "text": message });
        }

        const payload = {
          "app_name": APP_NAME,
          "user_id": USER_ID,
          "session_id": SESSION_ID,
          "new_message": { "role": "user", "parts": parts }
        };

        console.log(' Sending payload:', {
          app_name: payload.app_name,
          user_id: payload.user_id,
          session_id: payload.session_id,
          parts_count: parts.length,
          file_count: parts.filter(p => p.inline_data).length,
          has_text: parts.some(p => p.text)
        });

        const response = await fetch(`${ADK_SERVER_URL}/run`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        loadingElement.remove();

        if (!response.ok) {
          const errorText = await response.text();
          console.error(' Backend error:', { status: response.status, statusText: response.statusText, body: errorText });
          throw new Error(`HTTP ${response.status}: ${errorText.substring(0, 200)}`);
        }

        const data = await response.json();
        let assistantMessage = '';
        let cartData = null;

        if (Array.isArray(data)) {
          for (const event of data) {
            if (event.content && event.content.parts) {
              for (const part of event.content.parts) {
                if (part.text) {
                  assistantMessage += part.text + '\n';
                }

                if (part.functionResponse && part.functionResponse.response) {
                  console.log(' Found functionResponse');
                  let funcResp = part.functionResponse.response;

                  if (funcResp && typeof funcResp === 'object' && funcResp.result) {
                    console.log(' Unwrapping ADK result wrapper');
                    funcResp = funcResp.result;
                  }

                  let parsedResp = funcResp;

                  if (typeof funcResp === 'string') {
                    try {
                      parsedResp = JSON.parse(funcResp);
                      console.log(' Parsed function response:', parsedResp);
                    } catch (e) {
                      console.error(' Failed to parse:', e);
                      continue;
                    }
                  }

                  if (parsedResp && parsedResp.image_data) {
                    console.log(' Image data found! Length:', parsedResp.image_data.length);

                    const imageDiv = document.createElement('div');
                    imageDiv.className = 'message assistant';

                    const avatar = document.createElement('div');
                    avatar.className = 'avatar';
                    avatar.textContent = 'ES';

                    const messageContent = document.createElement('div');
                    messageContent.className = 'message-content';

                    if (parsedResp.text_response) {
                      const textPara = document.createElement('p');
                      textPara.textContent = parsedResp.text_response;
                      textPara.style.marginBottom = '0.5rem';
                      messageContent.appendChild(textPara);
                    }

                    const img = document.createElement('img');
                    img.src = `data:image/jpeg;base64,${parsedResp.image_data}`;
                    img.style.maxWidth = '100%';
                    img.style.height = 'auto';
                    img.style.borderRadius = '8px';
                    img.style.marginTop = '0.5rem';
                    img.alt = 'Generated image';

                    img.onload = function () {
                      console.log(' Image loaded successfully!');
                    };

                    img.onerror = function () {
                      console.error(' Image failed to load');
                      messageContent.innerHTML = '<p>Failed to load image</p>';
                    };

                    messageContent.appendChild(img);
                    imageDiv.appendChild(avatar);
                    imageDiv.appendChild(messageContent);
                    messagesContainer.appendChild(imageDiv);
                    messagesContainer.scrollTop = messagesContainer.scrollHeight;
                  }

                  if (parsedResp && parsedResp.video_url) {
                    console.log(' Video URL found!');

                    const videoDiv = document.createElement('div');
                    videoDiv.className = 'message assistant';

                    const avatar = document.createElement('div');
                    avatar.className = 'avatar';
                    avatar.textContent = 'ES';

                    const messageContent = document.createElement('div');
                    messageContent.className = 'message-content';

                    if (parsedResp.text_response) {
                      const textPara = document.createElement('p');
                      textPara.textContent = parsedResp.text_response;
                      textPara.style.marginBottom = '0.5rem';
                      messageContent.appendChild(textPara);
                    }

                    const video = document.createElement('video');
                    video.src = parsedResp.video_url;
                    video.controls = true;
                    video.style.maxWidth = '100%';
                    video.style.borderRadius = '8px';
                    video.style.marginTop = '0.5rem';

                    messageContent.appendChild(video);
                    videoDiv.appendChild(avatar);
                    videoDiv.appendChild(messageContent);
                    messagesContainer.appendChild(videoDiv);
                    messagesContainer.scrollTop = messagesContainer.scrollHeight;
                  }

                  if (parsedResp && parsedResp.payment_form_trigger && parsedResp.cart_id && parsedResp.client_secret) {
                    console.log('Found payment cart data!', parsedResp);
                    cartData = parsedResp;
                  }
                }
              }
            }
          }
        }

        assistantMessage = assistantMessage.trim();

        if (assistantMessage) {
          addMessage(assistantMessage, 'assistant');
        }

        if (cartData && cartData.cart_id && cartData.client_secret) {
          addPaymentForm(
            cartData.cart_id,
            cartData.client_secret,
            cartData.cart_summary
          );
        } else if (assistantMessage && (
          assistantMessage.toLowerCase().includes('processing payment') ||
          assistantMessage.toLowerCase().includes('created your cart') ||
          assistantMessage.toLowerCase().includes('cart created')
        )) {
          setTimeout(async () => {
            try {
              const cartResponse = await fetch(`${SERVICES_API}/payments/latest-cart`);
              const cartResult = await cartResponse.json();

              if (cartResult.success && cartResult.cart_id && cartResult.client_secret) {
                addPaymentForm(
                  cartResult.cart_id,
                  cartResult.client_secret,
                  cartResult.cart_summary
                );
              }
            } catch (e) {
              console.error('Error fetching latest cart:', e);
            }
          }, 500);
        }

      } catch (error) {
        loadingElement.remove();
        addMessage(`Sorry, I encountered an error: ${error.message}`, 'assistant');
      } finally {
        sendBtn.disabled = false;
        updateInputButtons();
        messageInput.focus();
      }
    }

    const dragDropOverlay = document.getElementById('dragDropOverlay');
    let dragCounter = 0;

    window.addEventListener('dragenter', (e) => {
      e.preventDefault();
      if (e.dataTransfer.types.includes('Files')) {
        dragCounter++;
        dragDropOverlay.classList.add('visible');
      }
    });

    window.addEventListener('dragover', (e) => {
      e.preventDefault();
    });

    window.addEventListener('dragleave', (e) => {
      e.preventDefault();
      if (e.relatedTarget === null || e.relatedTarget === document.documentElement) {
        dragCounter--;
        if (dragCounter <= 0) {
          dragCounter = 0;
          dragDropOverlay.classList.remove('visible');
        }
      }
    });

    window.addEventListener('drop', (e) => {
      e.preventDefault();
      dragCounter = 0;
      dragDropOverlay.classList.remove('visible');

      const files = Array.from(e.dataTransfer.files);
      if (files.length > 0) {
        attachedFiles = [...attachedFiles, ...files];
        showFilePreview();
        updateInputButtons();
      }
    });

    // ========================================
    // PAGE LOAD - Initialize everything
    // ========================================
    window.addEventListener('load', () => {
      console.log(' Page fully loaded');

      loadTheme();
      updateInputButtons();
      messageInput.focus();
      initializeStripe();

      // Check for OAuth success/error in URL
      const urlParams = new URLSearchParams(window.location.search);

      if (urlParams.has('oauth_success')) {
        const service = urlParams.get('oauth_success');
        console.log(` OAuth success for ${service}`);

        // Update UI based on service
        if (service === 'hubspot') {
          localStorage.setItem('hubspot_connected', 'true');
          updateHubspotStatus(true);

          // Show success message in chat
          setTimeout(() => {
            addMessage(' HubSpot connected successfully! You can now sync contacts to your HubSpot CRM.', 'assistant');
          }, 500);
        }

        // Clean up URL
        window.history.replaceState({}, document.title, window.location.pathname);
      }

      if (urlParams.has('oauth_error')) {
        const service = urlParams.get('oauth_error');
        const message = urlParams.get('message') || 'Unknown error';
        console.error(` OAuth error for ${service}: ${message}`);

        // Show error message
        alert(`Failed to connect ${service}: ${message}`);

        // Clean up URL
        window.history.replaceState({}, document.title, window.location.pathname);
      }

      // Load HubSpot connection status on page load
      checkHubspotConnection();
    });

    // ========================================
    // STARTER PROMPTS FUNCTIONALITY
    // ========================================
    const starterPromptsSection = document.getElementById('starterPrompts');
    const promptCategories = document.getElementById('promptCategories');
    const promptOptionsContainer = document.getElementById('promptOptionsContainer');
    const promptOptionsList = document.getElementById('promptOptionsList');
    const categoryTitle = document.getElementById('categoryTitle');
    const categoryIcon = document.getElementById('categoryIcon');
    const closePromptOptions = document.getElementById('closePromptOptions');

    // Define all prompt options
    const promptData = {
      ideas: {
        title: 'Get Ideas',
        icon: '<path d="M176,232a8,8,0,0,1-8,8H88a8,8,0,0,1,0-16h80A8,8,0,0,1,176,232Zm40-128a87.55,87.55,0,0,1-33.64,69.21A16.24,16.24,0,0,0,176,186v6a16,16,0,0,1-16,16H96a16,16,0,0,1-16-16v-6a16,16,0,0,0-6.23-12.66A87.59,87.59,0,0,1,40,104.49C39.74,56.83,78.26,17.14,125.88,16A88,88,0,0,1,216,104Zm-16,0a72,72,0,0,0-73.74-72c-39,.92-70.47,33.39-70.26,72.39a71.65,71.65,0,0,0,27.64,56.3A32,32,0,0,1,96,186v6h64v-6a32.15,32.15,0,0,1,12.47-25.35A71.65,71.65,0,0,0,200,104Zm-16.11-9.34a57.6,57.6,0,0,0-46.56-46.55,8,8,0,0,0-2.66,15.78c16.57,2.79,30.63,16.85,33.44,33.45A8,8,0,0,0,176,104a9,9,0,0,0,1.35-.11A8,8,0,0,0,183.89,94.66Z"></path>',
        options: [
          'Suggest event types I could host',
          'What industries sponsor events like mine?',
          'Give me sponsorship pitch ideas',
          'How to approach potential sponsors?',
          'What makes a successful event?'
        ]
      },
      images: {
        title: 'Create Images',
        icon: '<path d="M227.31,73.37,182.63,28.68a16,16,0,0,0-22.63,0L36.69,152A15.86,15.86,0,0,0,32,163.31V208a16,16,0,0,0,16,16H92.69A15.86,15.86,0,0,0,104,219.31L227.31,96a16,16,0,0,0,0-22.63ZM92.69,208H48V163.31l88-88L180.69,120ZM192,108.68,147.31,64l24-24L216,84.68Z"></path>',
        options: [
          'Design an event poster for my upcoming conference',
          'Generate a sponsor banner with logo placement',
          'Create promotional graphics for social media',
          'Make a logo placement mockup for sponsors',
          'Design social media visuals for event promotion'
        ]
      },
      video: {
        title: 'Create Video',
        icon: '<path d="M164.44,121.34l-48-32A8,8,0,0,0,104,96v64a8,8,0,0,0,12.44,6.66l48-32a8,8,0,0,0,0-13.32ZM120,145.05V111l25.58,17ZM216,40H40A16,16,0,0,0,24,56V168a16,16,0,0,0,16,16H216a16,16,0,0,0,16-16V56A16,16,0,0,0,216,40Zm0,128H40V56H216V168Zm16,40a8,8,0,0,1-8,8H32a8,8,0,0,1,0-16H224A8,8,0,0,1,232,208Z"></path>',
        options: [
          { text: 'Generate event promo video', disabled: true },
          { text: 'Create sponsor spotlight video', disabled: true },
          { text: 'Make event recap video', disabled: true },
          { text: 'Design animated logo reveal', disabled: true },
          { text: 'Create social media video ad', disabled: true }
        ]
      },
      plan: {
        title: 'Plan Event',
        icon: '<path d="M208,32H184V24a8,8,0,0,0-16,0v8H88V24a8,8,0,0,0-16,0v8H48A16,16,0,0,0,32,48V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V48A16,16,0,0,0,208,32ZM72,48v8a8,8,0,0,0,16,0V48h80v8a8,8,0,0,0,16,0V48h24V80H48V48ZM208,208H48V96H208V208Z"></path>',
        options: [
          'I want to organize a tech conference. Help me plan it.',
          'Help me find sponsors for my event',
          'Create sponsorship packages for my event',
          'Draft outreach emails to potential sponsors',
          'Show me potential sponsors from your database'
        ]
      },
      sponsor: {
        title: 'Sponsor',
        icon: '<path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm40-68a28,28,0,0,1-28,28h-4v8a8,8,0,0,1-16,0v-8H104a8,8,0,0,1,0-16h36a12,12,0,0,0,0-24H116a28,28,0,0,1,0-56h4V72a8,8,0,0,1,16,0v8h16a8,8,0,0,1,0,16H116a12,12,0,0,0,0,24h24A28,28,0,0,1,168,148Z"></path>',
        options: [
          'I want to sponsor an event. What are my options?',
          'Show me sponsorship tiers and pricing',
          'Find events I can sponsor in my industry',
          'Process a $10,000 Gold sponsorship payment',
          'Make a custom $500 contribution'
        ]
      }
    };

    // Track states
    let textareaExpanded = false;
    let chatStarted = false;
    let previousInputValue = ''; // Track previous input value
    let promptsCurrentlyVisible = true; // Track if prompts are visible

    // Function to show category buttons with animation
    function showCategoriesWithAnimation() {
      promptCategories.classList.remove('hidden');
      // Remove animation class if it exists
      promptCategories.classList.remove('fade-in');
      // Force reflow to restart animation
      void promptCategories.offsetWidth;
      // Add animation class
      promptCategories.classList.add('fade-in');

      // Remove animation class after animation completes
      setTimeout(() => {
        promptCategories.classList.remove('fade-in');
      }, 300);
    }

    // Function to show entire prompts section with animation
    function showPromptsWithAnimation() {
      starterPromptsSection.classList.remove('hidden');
      promptsCurrentlyVisible = true;
      // Remove animation class if it exists
      starterPromptsSection.classList.remove('fade-in');
      // Force reflow to restart animation
      void starterPromptsSection.offsetWidth;
      // Add animation class
      starterPromptsSection.classList.add('fade-in');

      // Remove animation class after animation completes
      setTimeout(() => {
        starterPromptsSection.classList.remove('fade-in');
      }, 300);
    }

    // Category button click handlers
    document.querySelectorAll('.prompt-category-btn').forEach(btn => {
      btn.addEventListener('click', function () {
        const category = this.getAttribute('data-category');
        const data = promptData[category];

        // Update header
        categoryTitle.textContent = data.title;
        categoryIcon.innerHTML = data.icon;

        // Clear and populate options
        promptOptionsList.innerHTML = '';
        data.options.forEach(option => {
          const isDisabled = typeof option === 'object';
          const optionText = isDisabled ? option.text : option;

          const button = document.createElement('button');
          button.className = 'prompt-option';
          if (isDisabled) button.disabled = true;
          button.setAttribute('data-prompt', optionText);

          button.innerHTML = `
                <div style="flex: 1;">${optionText}</div>
                ${isDisabled ? '<span class="coming-soon-badge">Coming Soon</span>' : '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 256 256" class="prompt-option-arrow"><path d="M181.66,133.66l-80,80a8,8,0,0,1-11.32-11.32L164.69,128,90.34,53.66a8,8,0,0,1,11.32-11.32l80,80A8,8,0,0,1,181.66,133.66Z"></path></svg>'}
            `;

          if (!isDisabled) {
            button.addEventListener('click', function () {
              messageInput.value = optionText;
              messageInput.dispatchEvent(new Event('input'));
              messageInput.focus();
              promptOptionsContainer.classList.remove('active');
              showCategoriesWithAnimation();
            });
          }

          promptOptionsList.appendChild(button);
        });

        // Show options, hide categories
        promptOptionsContainer.classList.add('active');
        promptCategories.classList.add('hidden');
      });
    });

    // Close button handler with animation
    closePromptOptions.addEventListener('click', function () {
      promptOptionsContainer.classList.remove('active');
      showCategoriesWithAnimation();
    });

    // Function to check if prompts should be visible
    function updatePromptsVisibility() {
      const currentInputValue = messageInput.value.trim();
      const hasText = currentInputValue.length > 0;
      const currentHeight = parseInt(messageInput.style.height) || 24;
      const isExpanded = currentHeight > 50; // More than ~2 lines

      // Check if we transitioned from having text to no text
      const justBecameEmpty = previousInputValue.length > 0 && currentInputValue.length === 0;

      // Show prompts only if:
      // 1. No text in input
      // 2. Textarea not expanded
      // 3. Chat hasn't started yet
      const shouldShowPrompts = !hasText && !isExpanded && !chatStarted;

      if (shouldShowPrompts) {
        // Only animate if:
        // - Prompts are currently hidden AND
        // - We just transitioned from having text to no text (not already empty)
        if (!promptsCurrentlyVisible && justBecameEmpty) {
          showPromptsWithAnimation();
        } else if (!promptsCurrentlyVisible && previousInputValue.length === 0) {
          // Show without animation if already empty (page load case)
          starterPromptsSection.classList.remove('hidden');
          promptsCurrentlyVisible = true;
        }
      } else {
        if (promptsCurrentlyVisible) {
          starterPromptsSection.classList.add('hidden');
          promptsCurrentlyVisible = false;
        }
      }

      // Update previous value for next comparison
      previousInputValue = currentInputValue;

      // Track expansion state
      textareaExpanded = isExpanded;
    }

    // Monitor textarea changes
    messageInput.addEventListener('input', function () {
      this.style.height = 'auto';
      this.style.height = Math.min(this.scrollHeight, 200) + 'px';
      updatePromptsVisibility();
      updateInputButtons();
    });

    // Monitor textarea for manual resizing (if user deletes text)
    messageInput.addEventListener('keyup', function () {
      updatePromptsVisibility();
    });

    // Update the switchToChatView function to hide prompts permanently
    const originalSwitchToChatView = switchToChatView;
    switchToChatView = function () {
      originalSwitchToChatView();
      chatStarted = true; // Mark that chat has started
      starterPromptsSection.classList.add('hidden');
      promptsCurrentlyVisible = false;
    };

    // Initial visibility check
    updatePromptsVisibility();
  </script>
</body>

</html>